"use strict";function get_path(a){var b=a.x0,c=a.x1,d=d3.interpolateNumber(b,c),e=d(curvature),f=d(1-curvature),g=a.y0,h=a.y1;return"M"+b+","+g+"C"+e+","+g+" "+f+","+h+" "+c+","+h}function Character_(a,b,c){this.name=a,this.id=b,this.group=c,this.group_ptr=null,this.first_scene=null,this.group_positions={},this.group_name_positions={}}function Link(a,b,c,d){this.from=a,this.to=b,this.char_id=d,this.group=c,this.x0=0,this.y0=-1,this.x1=0,this.y1=-1,this.char_ptr=null}function SceneNode(a,b,c,d,e){this.chars=a,this.start=b,this.duration=c,this.id=d,this.paper=e,this.char_ptrs=[],this.x=0,this.y=0,this.width=node_width,this.height=0,this.in_links=[],this.out_links=[],this.name="",this.has_char=function(a){for(var b=0;b<this.chars.length;b++)if(a===this.chars[b])return!0;return!1},this.char_node=!1,this.first_scene=null,this.median_group=null}function generate_links(a,b){for(var c=[],d=0;d<a.length;d++){var e,f=[];for(e=0;e<b.length;e++)b[e].has_char(a[d].id)&&(f[f.length]=b[e]);for(f.sort(function(a,b){return a.start-b.start}),a[d].first_scene=f[0],e=1;e<f.length;e++)c[c.length]=new Link(f[e-1],f[e],a[d].group,a[d].id),c[c.length-1].char_ptr=a[d],f[e-1].out_links[f[e-1].out_links.length]=c[c.length-1],f[e].in_links[f[e].in_links.length]=c[c.length-1]}return c}function Group(){this.min=-1,this.max=-1,this.id=-1,this.chars=[],this.first_scene_chars=[],this.median_count=0,this.biggest_scene=0,this.all_chars={},this.char_scenes=[],this.order=-1}function sort_groups(a,b,c,d){if(2===b.length)return a[d]=b[0],void(a[c]=b[1]);if(c>=d)return void(b.length>0&&(a[c]=b[0]));var e=Math.floor((c+d)/2);a[e]=b[0];for(var f=c,g=e-1,h=e+1,i=d,j=[],k=[],l=1;l<b.length;l++)l%2===0?j[j.length]=b[l]:k[k.length]=b[l];sort_groups(a,j,f,g),sort_groups(a,k,h,i)}function define_groups(a){var b=[];return a.forEach(function(a){var c=!1;if(b.forEach(function(b){b.id===a.group&&(c=!0,b.chars[b.chars.length]=a,a.group_ptr=b)}),!c){var d=new Group;d.id=a.group,d.chars[d.chars.length]=a,a.group_ptr=d,b[b.length]=d}}),b}function find_group(a,b,c){var d;for(d=0;d<a.length&&a[d].id!==c;d++);d===a.length&&console.log("ERROR: char not found, id = "+c);var e;for(e=0;e<b.length&&(!a[d]||!b[e]||a[d].group!==b[e].id);e++);return e===b.length&&console.log("ERROR: groups not found."),e}function find_median_groups(a,b,c,d,e){b.forEach(function(b){if(!b.char_node){var d,f=[];for(d=0;d<a.length;d++)f[d]=0;var g=0;b.chars.forEach(function(h){var i=find_group(c,a,h);if(f[i]+=1,!e&&f[i]>=f[g]||f[i]>f[g])g=i;else if(f[i]===f[g]){var j=0,k=0;for(d=0;d<b.in_links.length;d++)null!==b.in_links[d].from.median_group&&(b.in_links[d].from.median_group.id===a[i].id?j+=1:b.in_links[d].from.median_group.id===a[g].id&&(k+=1));for(d=0;d<b.out_links.length;d++)null!==b.out_links[d].to.median_group&&(b.out_links[d].to.median_group.id===a[i].id?j+=1:b.out_links[d].to.median_group.id===a[g].id&&(k+=1));j>k&&(g=i)}}),b.median_group=a[g],a[g].median_count+=1,b.chars.forEach(function(b){a[g].all_chars[b]=!0})}}),a.forEach(function(a){var b=[];for(var c in a.all_chars)b.push(d[c]);a.all_chars=b})}function sort_groups_main(a,b){a.sort(function(a,b){return b.median_count-a.median_count});var c,d=[];for(c=0;c<a.length;c++)d[c]=a[c];if(b){var e=Math.floor(a.length/2);d[e]=a[0];var f=[];for(c=0;e>c;c++)f[c]=a[c];var g=[];for(c=e+1;c<a.length;c++)g[c-e-1]=a[c];sort_groups(d,f,0,e),sort_groups(d,g,e+1,a.length)}else if(a.length>0&&(d[0]=a[0]),a.length>1&&(d[a.length-1]=a[1]),a.length>2){var h=[];for(c=0;c<a.length-2;c++)h[c]=a[c+2];sort_groups(d,h,1,a.length-2)}for(c=0;c<d.length;c++)d[c].order=c;return d}function add_char_scenes(a,b,c,d,e,f){var g=[];b.forEach(function(a){equal_scenes||(a.start+=e)});var h=0;d.forEach(function(a){var b=a.all_chars.length*text_height;a.min=h,a.max=a.min+b,h+=b+group_gap});for(var i=0;i<a.length;i++){var j=new SceneNode([a[i].id],[0],[1]);if(j.char_node=!0,j.y=i*text_height,j.x=0,j.width=5,j.height=link_width,j.name=a[i].name,j.chars[j.chars.length]=a[i].id,j.id=b.length,j.comic_name=f,a[i].first_scene){var k=new Link(j,a[i].first_scene,a[i].group,a[i].id);k.char_ptr=a[i],j.out_links[j.out_links.length]=k,a[i].first_scene.in_links[a[i].first_scene.in_links.length]=k,c[c.length]=k,j.first_scene=a[i].first_scene,b[b.length]=j,g[g.length]=j,j.median_group=a[i].first_scene.median_group}}return g}function calculate_node_positions(a,b,c,d,e,f,g,h,i,j){b.forEach(function(a){if(!a.char_node){a.height=Math.max(0,a.chars.length*link_width+(a.chars.length-1)*link_gap),a.width=3*h;for(var b=0,c=0,d=0,e=0,f=0;f<a.chars.length;f++){var g=j[a.chars[f]];if(g){var i=g.group_positions[a.median_group.id];if(!i)continue;g.group.id===a.median_group.id?(b+=i,d+=1):(c+=i,e+=1)}}var k;0!==e?k=c/e:0!==d?k=b/d:(console.log("ERROR: den1 and den2 are 0. Scene doesn't have characters?"),k=a.median_group.min),a.y=k-a.height/2,equal_scenes?a.x=a.start:a.x=a.start*h}}),f.forEach(function(a){null!==a.first_scene&&(a.first_scene.x>per_width*raw_chart_width?a.x=a.first_scene.x-name_shift:a.x=i*h-name_shift)})}function calculate_link_positions(a){a.forEach(function(a){a.in_links.sort(function(a,b){return a.char_ptr.group_ptr.order-b.char_ptr.group_ptr.order}),a.out_links.sort(function(a,b){return a.char_ptr.group_ptr.order-b.char_ptr.group_ptr.order});var b;for(b=0;b<a.out_links.length;b++)a.out_links[b].y0=-1;var c=0;for(b=0;b<a.in_links.length;b++)a.in_links[b].y1=a.y+b*(link_width+link_gap)+link_width/2,a.in_links[b].x1=a.x+.5*a.width,c<a.out_links.length&&a.out_links[c].char_id===a.in_links[b].char_id&&(a.out_links[c].y0=a.in_links[b].y1,c++);for(b=0;b<a.out_links.length;b++)-1===a.out_links[b].y0&&(a.out_links[b].y0=a.y+b*(link_width+link_gap)+link_width/2),a.out_links[b].x0=a.x+.5*a.width})}function styleLinkedAuthors(a,b,c,d){function e(a,b){d3.selectAll('[charid="'+a.comic_name+"_"+a.chars[0]+'"]').style({"stroke-opacity":b}),d3.selectAll('[scene_id="'+a.id+'"]').style({opacity:1})}if(d||(d=[]),d.indexOf(a.id)>-1);else if(d.push(a.id),0===a.in_links.length)c?e(a,"1"):e(a,"0.6");else for(var f=0;f<a.in_links.length;++f)if(b.indexOf(a.in_links[f].char_id)>-1){var g;c?(g=a.in_links[f].from,styleLinkedAuthors(g,b,c,d)):(g=a.in_links[f].from,styleLinkedAuthors(g,b,c,d))}}function draw_nodes(a,b){function c(a){var b,c=a.paper;if(c)b="paper/"+c,window.location.href=b;else{var d=a.chars[0],e=authorIndex[d];b="collaboration?author="+e+"&author="+authorIndex[0],window.location.href=b}}function d(a){if(d3.selectAll(".node_char").style(opacity.translucentNodes),d3.selectAll(".link").style(opacity.translucentLinks),styleLinkedAuthors(a,a.chars,!0),a.char_node!==!0){var b="/ce-store/stores/DEFAULT/instances/"+a.paper;d3.json(b,function(a,b){if(a)throw a;var c=b.property_values.title[0];d3.selectAll('[class="paper-title"]').remove(),d3.selectAll('[class="paper-title-placeholder"]').attr("class","hidden paper-title-placeholder"),d3.select("#title-box").append("text").attr("class","paper-title").text(c)})}}function e(a){d3.selectAll(".node_char").style(opacity.opaqueNodes),d3.selectAll(".link").style(opacity.opaqueLinks),styleLinkedAuthors(a,a.chars,!1),d3.selectAll('[class="paper-title"]').remove(),d3.selectAll('[class="hidden paper-title-placeholder"]').attr("class","paper-title-placeholder")}var f=b.append("g").selectAll(".node").data(a).enter().append("g").attr("class","node").attr("class",function(a){return a.name?"node node_char":"node"}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).attr("scene_id",function(a){return a.id}).on("mouseover",d).on("mouseout",e).on("click",c);f.append("rect").attr("width",function(a){return a.width}).attr("height",function(a){return a.height}).attr("class","scene").attr("rx",20).attr("ry",10).append("title").text(function(a){return a.name}),name_bg&&f.append("rect").filter(function(a){return a.char_node}).attr("x",function(a){return-(5*(a.name.length+2))}).attr("y",function(a){return-3}).attr("width",function(a){return 5*(a.name.length+1)}).attr("height",7.5).attr("transform",null).attr("fill","#fff").style("opacity",1),f.append("text").filter(function(a){return a.char_node}).attr("x",-6).attr("y",function(a){return 0}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(function(a){return a.name}).filter(function(a){return!1}).attr("x",function(a){return 6+a.width}).attr("text-anchor","start")}function draw_links(a,b){function c(a){d3.selectAll(".node_char").style(opacity.translucentNodes),d3.selectAll(".link").style(opacity.translucentLinks),styleLinkedAuthors(a.from,[a.char_id],!0)}function d(a){d3.selectAll(".node_char").style(opacity.opaqueNodes),d3.selectAll(".link").style(opacity.opaqueLinks),styleLinkedAuthors(a.from,[a.char_id],!1)}b.append("g").selectAll(".link").data(a).enter().append("path").attr("class","link").attr("d",function(a){return get_path(a)}).attr("from",function(a){return a.from.comic_name+"_"+a.from.id}).attr("to",function(a){return a.to.comic_name+"_"+a.to.id}).attr("charid",function(a){return a.from.comic_name+"_"+a.char_id}).style("stroke",function(a){return d3.rgb(color[a.group]).toString()}).style("stroke-width",link_width).style("stroke-opacity","0.6").style("stroke-linecap","round").on("mouseover",c).on("mouseout",d)}function drawNarrativeChart(a,b,c,d,e){function f(){var a=d3.event.translate[0],b=d3.event.translate[1]+drag_offset;$.attr("transform","translate("+[a,b]+")scale("+d3.event.scale+")")}function g(){d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0)}function h(a){d3.select(this).attr("cx",a.x=d3.event.x).attr("cy",a.y=d3.event.y)}function i(a){d3.select(this).classed("dragging",!1)}function j(){var a=d3.select("#narrative-chart"),b=d3.select("#papers-list"),c=d3.select(".toggle-button");a[0][0].getAttribute("class").indexOf("hidden")>-1?(a.attr("class","panel"),b.attr("class","hidden panel"),c.text("List view")):(a.attr("class","hidden panel"),b.attr("class","panel"),c.text("Narrative view"))}var k=e.structured_response.main_instance.property_values,l=e.structured_response.related_instances,m=0,n={},o=[],p={AC:0,IND:1,GOV:2},q=l[k["is employed by"][0]].property_values.type,r={name:k["full name"][0],id:0,group:q?p[q[0]]:null};for(r.group||0===r.group||(r.group=p.UNKNOWN),o.push(r),n[e.structured_response.main_instance._id]=r.id,authorIndex[r.id]=e.structured_response.main_instance._id,m=0;m<k["co-author"].length;++m){var s=l[k["co-author"][m]].property_values["is employed by"];s=s?s[0]:"unknown";var t;l[s]&&(t=l[s].property_values.type?l[s].property_values.type[0]:null);var u=l[k["co-author"][m]],v=u.property_values["full name"]?u.property_values["full name"][0]:u._id;r={name:v,id:m+1,group:t?p[t]:p.UNKNOWN},o.push(r),n[u._id]=r.id,authorIndex[r.id]=u._id}var w={scenes:[]},x=[];for(m=0;m<k.wrote.length;++m){var y,z=l[k.wrote[m]].property_values["final date"][0],A=l[z].property_values,B=(A.year[0],A.month?A.month[0]:0),C=A.day?A.day[0]:null;y=C?new Date(A.year,B,C):new Date(A.year,B),x.push({date:y,paper:k.wrote[m]})}var D=function(a,b){var c=a.date,d=b.date;return c>d?1:d>c?-1:0};x.sort(D);var E,F=x[0].date.getTime()/1e9;for(m=0;m<x.length;++m){var G=x[m].date.getTime()/1e9-F;E=x[m+1]?x[m+1].date.getTime()/1e9-F:G;for(var H={chars:[],duration:E-G,start:G,paper:x[m].paper,id:m},I=l[x[m].paper].property_values,J=0;J<I.author.length;++J){var K=l[I.author[J]].property_values,L=K["author person"];L&&H.chars.push(n[L])}w.scenes.push(H)}var M={top:20,right:100,bottom:20,left:1},N=raw_chart_width-M.left-M.right,O=w.scenes,P=(N-longest_name)/(O.length+1),Q=0,R=[];for(m=0;m<O.length;m++){var S,T=parseInt(O[m].duration,10);S=equal_scenes?m*P+longest_name:parseInt(O[m].start,10);O[m].chars;R[R.length]=new SceneNode(O[m].chars,S,T,parseInt(O[m].id,10),O[m].paper),R[R.length-1].comic_name=a,Q+=T}R.sort(function(a,b){return a.start-b.start}),Q-=R[R.length-1].duration,R[R.length-1].duration=0;var U=Math.min((N-longest_name)/Q,15),V=Math.round(longest_name/U);Q+=V,U=Math.min(N/Q,15);var W=700,X=W-M.top-M.bottom,Y=d3.behavior.zoom().scaleExtent([0,10]).on("zoom",f),Z=(d3.behavior.drag().origin(function(a){return a}).on("dragstart",g).on("drag",h).on("dragend",i),d3.select("#narrative-chart").append("svg").attr("width","100%").attr("height","100%").attr("class","chart").attr("id",a).append("g").call(Y)),$=(Z.append("rect").attr("width",N+M.left+M.right).attr("height",X+M.top+M.bottom).attr("class","chart").style("fill","none").style("pointer-events","all"),Z.append("g").attr("id","narrative-container").attr("transform","translate("+M.left+","+M.top+")scale(1)")),_=[],aa=[];for(m=0;m<o.length;m++)_[_.length]=new Character_(o[m].name,o[m].id,o[m].group),aa[o[m].id]=_[_.length-1];var ba=define_groups(_);find_median_groups(ba,R,_,aa,b),ba=sort_groups_main(ba,c);var ca=generate_links(_,R),da=add_char_scenes(_,R,ca,ba,V,a);ba.forEach(function(a){a.all_chars.sort(function(a,b){return a.group_ptr.order-b.group_ptr.order});for(var b=a.min,c=0;c<a.all_chars.length;c++)a.all_chars[c]&&(a.all_chars[c].group_positions[a.id]=b+c*text_height)}),calculate_node_positions(_,R,Q,N,X,da,ba,U,V,aa),R.forEach(function(a){if(!a.char_node){var b=[];a.in_links.forEach(function(a){a.from.char_node&&(b[b.length]=a.from)});for(var c=0;c<b.length;c++)b[c].y=a.y+a.height/2+c*text_height}}),da.forEach(function(a){var b=aa[a.chars[0]];if(b.first_scene.x<per_width*N){var c=b.first_scene.median_group;a.y=b.group_positions[c.id]}}),calculate_link_positions(R,_,ba,aa),X=ba[ba.length-1].max+5*group_gap,W=X+M.top+M.bottom,draw_links(ca,$),draw_nodes(R,$);var ea,fa=document.getElementById("narrative-chart"),ga=document.getElementById("narrative-container"),ha=x[0].date,ia=x[x.length-1].date,ja=d3.time.month.offset(ha,-1),ka=d3.time.month.offset(ia,1),la=ga.getBoundingClientRect().width,ma=!1;raw_chart_width>la?(ea=la,ma=!0):ea=raw_chart_width;var na=d3.time.scale().domain([ja,ka]).range([ja,ka].map(d3.time.scale().domain([ha,ia]).range([0,ea-160]))),oa=d3.svg.axis().scale(na).orient("bottom"),pa=$.append("g").attr("class","x axis").attr("transform","translate("+(longest_name+20)+","+(X+M.top)+")").call(oa).selectAll("text").attr("y",6).attr("x",6).style("text-anchor","start");ma&&pa.attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(90)");var qa=fa.getBoundingClientRect(),ra=ga.getBoundingClientRect(),sa=ra.width;200>sa&&(sa=2*sa);var ta=(qa.width-140)/sa,ua=qa.height-100,va=ra.height;if(1>ta&&(ta=ua/va,ta>1&&(ta=1)),$.attr("transform","translate("+M.left+","+M.top+")scale("+ta+")"),Y.scale(ta),qa=fa.getBoundingClientRect(),ra=ga.getBoundingClientRect(),ua=qa.height,va=ra.height,ua>va){var wa=ua-va;drag_offset=wa/2}var xa=0;if(ra.width<qa.width){var ya=qa.width-140-ra.width;xa=ya/2}$.attr("transform","translate("+(M.left+xa)+","+(M.top+drag_offset)+")scale("+ta+")");var za=d3.select("#toggle-box").append("svg").attr("id","toggle").on("click",j),Aa=za.append("g");Aa.append("text").attr("class","toggle-button").text("List view");var Ba=d3.select("#narrative-chart").append("svg").attr("id","paper-title-box");Aa=Ba.append("g").attr("id","title-box").attr("transform","translate(0, 10)"),Aa.append("text").attr("class","paper-title-placeholder").text("Hover over a paper");var Ca=d3.select("#narrative-chart").append("svg").attr("class","narrative-legend"),Da={IND:"Industry",AC:"Academia",GOV:"Government"};m=0;for(var Ea in p)p.hasOwnProperty(Ea)&&(Aa=Ca.append("g"),Aa.append("rect").attr("fill",color[p[Ea]]).attr("class","legend-key").attr("transform","translate(10,"+15*m+")"),Aa.append("text").attr("transform","translate(30,"+(15*m+8)+")").text(Da[Ea]),m++)}angular.module("itapapersApp",["ui.router","ui.bootstrap","uiGmapgoogle-maps","datamaps","ngCsv","LocalStorageModule"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","localStorageServiceProvider",function(a,b,c,d){d.setPrefix("itapapersApp").setStorageCookie(1,"/").setStorageType("sessionStorage").setNotify(!0,!0),b.otherwise("/"),a.state("main",{url:"/?debug",templateUrl:"views/main.html",controller:"MainCtrl"}).state("author",{url:"/author/:authorId?debug",templateUrl:"views/author.html",controller:"AuthorCtrl"}).state("paper",{url:"/paper/:paperId?debug",templateUrl:"views/paper.html",controller:"PaperCtrl"}).state("venue",{url:"/venue/:venueId/:year?debug",templateUrl:"views/venue.html",controller:"VenueCtrl"}).state("organisation",{url:"/organisation/:organisationId?debug",templateUrl:"views/organisation.html",controller:"OrganisationCtrl"}).state("project",{url:"/project/:projectId?debug",templateUrl:"views/project.html",controller:"ProjectCtrl"}).state("collaboration",{url:"/collaboration?author&debug",templateUrl:"views/collaboration.html",controller:"CollaborationCtrl"}).state("results",{url:"/results?debug",templateUrl:"views/results.html",controller:"ResultsCtrl"}).state("statistics",{url:"/statistics",templateUrl:"views/statistics.html",controller:"StatisticsCtrl"}).state("comments",{url:"/comments?debug",templateUrl:"views/comments.html",controller:"CommentsCtrl"}),c.html5Mode(!0)}]),angular.module("itapapersApp").controller("MainCtrl",["$scope","$stateParams","$location","$sce","store","charts","debug","documentTypes","utils","csv","colours","localStorageService",function(a,b,c,d,e,f,g,h,i,j,k,l){a.listTypes=["papers","authors","venues","projects","organisations","co-authors"],a.listLength=50,a.listName=a.listTypes[0],a.sortNames=["authors","papers"],a.sortName=a.sortNames[0],a.sortValues=["-value","-papers"],a.sortValue=a.sortValues[0],a.journalType=h.journal,a.externalConferenceType=h.external,a.patentType=h.patent,a.internalConferenceType=h.internal,a.technicalReportType=h.technical,a.otherDocumentType=h.other,a.journalInput=a.externalInput=a.patentInput=a.internalInput=a.technicalInput=a.otherInput=a.acInput=a.indInput=a.govInput=!0,a.scatterYAxisOpts=["hIndex","citations"],a.scatterYAxis=a.scatterYAxisOpts[0];var m={};m[a.scatterYAxisOpts[0]]="H-Index",m[a.scatterYAxisOpts[1]]="Citation Count";var n,o=d3.scale.ordinal().domain(["AC","IND","GOV"]).range(k.areas),p={AC:"Academic",IND:"Industry",GOV:"Government",Unknown:"Unknown"},q="unknown",r=h.nameMap;b.debug&&g.set(b.debug);var s=function(){a.typeCount={},a.typeCount[r[a.journalType]]=0,a.typeCount[r[a.externalConferenceType]]=0,a.typeCount[r[a.patentType]]=0,a.typeCount[r[a.internalConferenceType]]=0,a.typeCount[r[a.technicalReportType]]=0,a.typeCount[r[a.otherDocumentType]]=0};s(),a.select=function(b){a.listName=b,a.list=[],w(b)},a.sort=function(b){a.sortName=a.sortNames[b],a.sortValue=a.sortValues[b],n()},a.reset=function(){l.clearAll(),localStorage.clear()},a.width=window.innerWidth,a.height=window.innerHeight;var t=angular.element(".results-list"),u=a.height-305;t.css("max-height",u+"px"),a.filterPapers=function(b){return"undefined"!=typeof b.type?a.journalInput&&b.type.indexOf(r[a.journalType])>-1||a.externalInput&&b.type.indexOf(r[a.externalConferenceType])>-1||a.patentInput&&b.type.indexOf(r[a.patentType])>-1||a.internalInput&&b.type.indexOf(r[a.internalConferenceType])>-1||a.technicalInput&&b.type.indexOf(r[a.technicalReportType])>-1||a.otherInput&&b.type.indexOf(r[a.otherDocumentType])>-1:void 0},a.filterOrganisations=function(b){return a.acInput&&"AC"===b.area||a.indInput&&"IND"===b.area||a.govInput&&"GOV"===b.area};var v=function(b,c){a.list=[],a.areaNames=[],a.projects={};var d,e,f=[];s();for(var g=0;g<b.length;++g){var h,k,l,m,n,o,p,r,t,u,v,w,x,y;if(h=b[g][0],a.listName===a.listTypes[0]){var z=c[b[g][0]].property_values;w=c[b[g][1]].property_values,l=z.title?z.title[0]:q,k=w["citation count"]?parseInt(w["citation count"][0],10):0,u=z.weight?z.weight[0]:-1;var A,B=b[g][3];if(B.length>1){o=i.sortTypes(B);for(A in B)a.typeCount[B[A]]++}else o=[B[0]],a.typeCount[o]++;for(v=z["noteworthy reason"]?z["noteworthy reason"][0]:null,p=[],A=0;A<o.length;++A){p.push(i.getClassName(o[A]));var C=z.venue?z.venue[0]:z["old venue"]?z["old venue"]:"",D=z["original authors string"]?z["original authors string"][0]:"";f.push([h,l,k,o[A],C,D])}}else if(a.listName===a.listTypes[1]){var E=c[b[g][0]].property_values;w=c[b[g][1]].property_values,l=b[g][3],k=E["ita citation count"]?parseInt(E["ita citation count"][0],10):0,m=E["ita h-index"]?parseInt(E["ita h-index"][0],10):0;var F=E["journal paper count"]?parseInt(E["journal paper count"][0],10):0,G=E["conference paper count"]?parseInt(E["conference paper count"][0],10):0;n=F+G,f.push([h,l,k,m])}else if(a.listName===a.listTypes[2])l=b[g][1],f.push([h,l]);else if(a.listName===a.listTypes[3]){y=b[g][1];var H=c[h].property_values;l=H.name?H.name[0]:null,r=H.paper?H.paper.length:0,x=c[y].property_values.name?c[y].property_values.name[0]:null,f.push([y,x,h,l,r])}else if(a.listName===a.listTypes[4]){var I=c[h].property_values;l=I.name?I.name[0]:null,r=I.employs?I.employs.length:0,t=I["paper count"]?I["paper count"][0]:0,x=I.type?I.type[0]:null,x&&(p=i.getClassName(x)),f.push([h,l,x,r,t])}a.listName===a.listTypes[0]?r=k:a.listName===a.listTypes[1]&&(r=n),a.listName===a.listTypes[3]?(a.projects[x]||(a.projects[x]=[],a.areaNames.push(x)),a.projects[x].push({id:h,name:l,value:parseInt(r,10),papers:parseInt(t,10),"class":p})):a.list.push({id:h,name:l,value:parseInt(r,10),papers:parseInt(t,10),area:x,areaId:y,type:o,"class":p,weight:u,noteworthy:v})}a.listName===a.listTypes[0]?(d=["paper id","name","citation count","paper type","venue","authors"],e="papers"):a.listName===a.listTypes[1]?(d=["author id","name","citation count","h-index count"],e="authors"):a.listName===a.listTypes[2]?(d=["venue id","name"],e="venues"):a.listName===a.listTypes[3]?(d=["technical area id","technical area name","project id","project name","papers count"],e="projects"):a.listName===a.listTypes[4]&&(d=["organisation id","name","type","employee count","papers count"],e="organisations"),j.setName(e),j.setHeader(d),j.setData(f)},w=function(){e.getLastUpdated().then(function(b){b.results.length>0&&(a.lastUpdated=b.results[0][1])}),a.listName===a.listTypes[0]?e.getAcademicDocuments().then(function(b){v(b.data,b.instances),a.journalPapers=a.typeCount[r[a.journalType]],a.externalPapers=a.typeCount[r[a.externalConferenceType]],a.patents=a.typeCount[r[a.patentType]],a.internalPapers=a.typeCount[r[a.internalConferenceType]],a.technicalReports=a.typeCount[r[a.technicalReportType]],a.otherDocuments=a.typeCount[r[a.otherDocumentType]],a.totalPublications=a.journalPapers+a.externalPapers;var c=[{label:r[a.journalType],value:a.journalPapers},{label:r[a.externalConferenceType],value:a.externalPapers},{label:r[a.patentType],value:a.patents},{label:r[a.internalConferenceType],value:a.internalPapers},{label:r[a.technicalReportType],value:a.technicalReports},{label:r[a.otherDocumentType],value:a.otherDocuments}];z(c)}):a.listName===a.listTypes[1]?e.getPublishedPeople().then(function(a){v(a.data,a.instances);var b=f.getScatterData(a);x(b)}):a.listName===a.listTypes[2]?e.getEventSeries().then(function(a){v(a)}):a.listName===a.listTypes[3]?e.getProjects().then(function(a){v(a.results,a.instances)}):a.listName===a.listTypes[4]&&e.getOrganisations().then(function(a){v(a.results,a.instances);var b=f.getSunburstData(a);A(b)})},x=function(b){function c(){s.select(".x.axis").call(n),s.select(".y.axis").call(p),s.selectAll(".dot").attr("transform",function(a){return"translate("+k(a.totalPubs)+","+l(a.yValue)+")"})}var d=1.3*d3.max(b.hIndex,function(a){return+a.totalPubs}),e=-1,f=1.3*d3.max(b.hIndex,function(a){return+a.yValue}),g=-2,h={top:20,right:20,bottom:30,left:40},i=angular.element("#chart").width()-h.left-h.right,j=a.height-320-h.top-h.bottom,k=d3.scale.linear().domain([e,d]).range([0,i]),l=d3.scale.linear().domain([g,f]).range([j,0]),n=d3.svg.axis().scale(k).orient("bottom").tickSize(-j),p=d3.svg.axis().scale(l).orient("left").tickSize(-i),q=d3.behavior.zoom().x(k).y(l).scaleExtent([1,10]).on("zoom",c),r=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){var b="<h2>"+a.name+" <small>("+a.employer+")</small></h2><dl><dt>H-Index</dt><dd>"+a.hIndex+"</dd><dt>Citation Count</dt><dd>"+a.citations+"</dd><dt>ITA Publications</dt><dd>"+a.totalPubs+"</dd></dl>";return a.picture&&(b+="<img src='/"+a.picture+"' />"),b});angular.element("#chart-svg").remove();var s=d3.select("#chart").append("svg").attr("id","chart-svg").attr("width",i+h.left+h.right).attr("height",j+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")").call(q);s.append("rect").attr("width",i).attr("height",j).attr("fill","#fff"),s.append("g").attr("class","x axis scatter-axis").attr("transform","translate(0,"+j+")").call(n).append("text").attr("class","label").attr("x",i-5).attr("y",-6).style("text-anchor","end").text("Total ITA Publications"),s.append("g").attr("class","y axis scatter-axis").call(p).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("x",-5).attr("dy",".71em").style("text-anchor","end");var t=s.append("svg").attr("class","objects").attr("width",i).attr("height",j).call(r);s.append("rect").attr("x",i-120).attr("y",10).attr("width",110).attr("height",80).attr("class","scatter-legend"),d3.select("#h-index").on("click",function(){a.scatterYAxis=a.scatterYAxisOpts[0],a.$apply(),u()}),d3.select("#citation-count").on("click",function(){a.scatterYAxis=a.scatterYAxisOpts[1],a.$apply(),u()});var u=function(){var c=d3.select("#acInput"),d=d3.select("#indInput"),e=d3.select("#govInput"),f=c?c.property("checked"):null,g=d?d.property("checked"):null,h=e?e.property("checked"):null,j=b[a.scatterYAxis],n=j.filter(function(a){return f&&"AC"===a.industry||g&&"IND"===a.industry||h&&"GOV"===a.industry});y(n,t,m[a.scatterYAxis],r,k,l,i,p,o)};d3.selectAll(".scatterInput").on("change",u),y(b.hIndex,t,"H-Index",r,k,l,i,p,o)},y=function(b,d,e,f,g,h,i,j,k){var l=1.3*d3.max(b,function(a){return+a.yValue}),m=-(l/100),n=d3.select("#chart-svg");n.select(".y.axis .label").text(e),h.domain([m,l]),n.select(".y.axis").transition().duration(300).ease("sin-in-out").call(j);var o=d.selectAll(".dot").data(b);o.enter().append("circle").attr("class",function(a){return"dot "+a.industry}).style("fill",function(a){return k(a.industry)}).on("mouseover",f.show).on("mouseout",f.hide).on("click",function(b){f.hide();var d="/author/"+b.id;c.url(d),a.$apply()}),o.exit().transition().duration(300).ease("exp").remove(),o.transition().duration(300).style("fill",function(a){return k(a.industry)}).ease("quad").attr("r",3).attr("transform",function(a){return"translate("+g(a.totalPubs)+","+h(a.yValue)+")"});var q=n.selectAll(".legend").data(k.domain()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+20*b+")"});q.append("rect").attr("x",i-10).attr("y",40).attr("width",18).attr("height",18).style("fill",function(a){return k(a)}),q.append("text").attr("x",i-16).attr("y",50).attr("dy",".35em").style("text-anchor","end").text(function(a){return p[a]})},z=function(b){var c=.33*(a.width-200),d=a.height-500;(a.width<1e3||300>d)&&(c=300,d=300);var e=Math.min(c,d)/2,f=c/6,g=18,h=5,i=d3.scale.ordinal().range(k.papers);angular.element(".pie-svg").remove();var j=d3.select("#pie-chart").append("svg").attr("width",c).attr("height",d).attr("class","pie-svg").append("g").attr("transform","translate("+c/2+","+d/2+")"),l=d3.svg.arc().innerRadius(e-f).outerRadius(e),m=d3.layout.pie().value(function(a){return a.value}).sort(null),n=(j.selectAll("path").data(m(b)).enter().append("path").attr("d",l).attr("fill",function(a){return i(a.data.label)}),j.selectAll(".legend").data(i.domain()).enter().append("g").attr("class","legend").attr("display",function(a){for(var c=0;c<b.length;++c)if(b[c].label===a&&!b[c].value)return"none"}).attr("transform",function(a,b){var c=g+h,d=c*i.domain().length/2,e=-2.5*g,f=b*c-d;return"translate("+e+","+f+")"}));n.append("rect").attr("width",g).attr("height",g).style("fill",i).style("stroke",i),n.append("text").attr("x",g+h).attr("y",g-h).attr("class","pie-legend-text").text(function(a){return a})},A=function(b){function c(a){t=a,w.transition().duration(1e3).attrTween("d",f(a))}function d(a){a.x0=a.x,a.dx0=a.dx}function e(a,b){function c(b){var c=d(b);return a.x0=c.x,a.dx0=c.dx,v(c)}var d=d3.interpolate({x:a.x0,dx:a.dx0},a);if(0===b){var e=d3.interpolate(l.domain(),[t.x,t.x+t.dx]);return function(a){return l.domain(e(a)),c(a)}}return c}function f(a){"flare"===a.name?x.attr("display","inline"):x.attr("display","none");var b=d3.interpolate(l.domain(),[a.x,a.x+a.dx]),c=d3.interpolate(m.domain(),[a.y,1]),d=d3.interpolate(m.range(),[a.y?20:0,i]);return function(a,e){return e?function(b){return v(a)}:function(e){return l.domain(b(e)),m.domain(c(e)).range(d(e)),v(a)}}}var g=.5*(a.width-150),h=a.height-300,i=Math.min(g,h)/2,j=18,k=5,l=d3.scale.linear().range([0,2*Math.PI]),m=d3.scale.sqrt().range([0,i]),q=o,r=d3.tip().attr("class","d3-tip dark-tip small-tip").offset([-10,0]).html(function(a){return"AC"===a.name||"IND"===a.name||"GOV"===a.name?p[a.name]+" <small class='highlight'>("+a.value+" authors)</small>":a.name+" <small class='highlight'>("+a.value+" authors, "+a.papers+" papers)</small>"});angular.element(".sunburst-svg").remove();var s=d3.select(".sunburst").append("svg").attr("class","sunburst-svg").attr("width",g).attr("height",h).append("g").attr("transform","translate("+g/2+","+h/2+")");s.call(r);var t,u=d3.layout.partition().sort(null).value(function(a){return 1}),v=d3.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,l(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,l(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,m(a.y))}).outerRadius(function(a){return Math.max(0,m(a.y+a.dy))});t=b;var w=s.datum(b).selectAll("path").data(u.nodes).enter().append("path").attr("stroke","#fff").attr("d",v).style("fill",function(a){var b=(a.children?a:a.parent).name;return"flare"===b?"#22394A":q(b)}).on("click",c).on("mouseover",function(a){"flare"!==a.name&&r.show(a)}).on("mouseout",r.hide).each(d);n=function(){var b=function(b){if(!b.parent)return b.size;if(a.acInput&&"AC"===b.parent.name||a.indInput&&"IND"===b.parent.name||a.govInput&&"GOV"===b.parent.name){if(a.sortName===a.sortNames[0])return b.employees;if(a.sortName===a.sortNames[1])return b.papers}};w.data(u.value(b).nodes).transition().duration(1e3).attrTween("d",e)},d3.selectAll("input").on("change",n),n(),d3.select(self.frameElement).style("height",h+"px");var x=s.selectAll(".legend").data(q.domain()).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=j+k,d=c*q.domain().length/2,e=-2.5*j,f=b*c-d;return"translate("+e+","+f+")"});x.append("rect").attr("width",j).attr("height",j).style("fill",q).style("stroke",q),x.append("text").attr("x",j+k).attr("y",j-k).attr("class","pie-legend-text").text(function(a){return p[a]})};w()}]),angular.module("itapapersApp").controller("VenueCtrl",["$scope","$stateParams","store","hudson","colours","debug","documentTypes","utils","csv",function(a,b,c,d,e,f,g,h,i){a.map={},a.multiplier=3;var j={},k={},l={},m={},n={},o="Unknown",p=null;b.debug&&f.set(b.debug),a.$on("question:added",function(){q()});var q=function(){var b=d.getLatestQuestion();p&&(a[p]=!1),b&&"highlight"===b.type&&(a[b.property+"Highlight"]=!0,p=b.property+"Highlight")};a.select=function(b){a.selectedYear=b,a.map.pluginData={bubbles:j[b],arc:k[b]},a.papers=l[b],a.authors=m[b],a.bubbles=j[b];var c=j[b][j[b].length-1];a.startDate=c.startDate,a.endDate=c.endDate,a.url=c.url,i.setData(n[b])},a.width=window.innerWidth,a.height=window.innerHeight;var r=angular.element("#venue-map"),s=a.height-220;r.css("height",s+"px");var t=angular.element(".mini"),u=.33*(a.height-520);t.css("max-height",u+"px"),a.map.world={scope:"world",projection:"mercator",geographyConfig:{borderWidth:1,borderColor:"#293e4c",highlightBorderColor:"#01a8ca",highlightFillColor:"#fff"},bubblesConfig:{borderWidth:0,highlightBorderWidth:0,highlightFillColor:"#84c142"},arcConfig:{strokeColor:"#fde876",strokeWidth:1,arcSharpness:1,animationSpeed:1e3},fills:{defaultFill:"#f0f0f0",EVENT:"#fde876",AC:e.AC,IND:e.IND,GOV:e.GOV}},c.getEventSeriesDetails().then(function(c){
for(var d=c.instances,e={},f=0;f<c.results.length;++f){var g=c.results[f],p=!1,r=g[0],s=g[1],t=g[2],u=g[3],v=g[4],w=g[5],x=g[6],y=g[7];if(u===b.venueId){var z=d[s].property_values,A=d[x].property_values,B=d[w].property_values,C=z["full name"]?z["full name"][0]:o,D=A.latitude?A.latitude[0]:o,E=A.longitude?A.longitude[0]:o,F=B.latitude?B.latitude[0]:o,G=B.longitude?B.longitude[0]:o;if(j[t])for(var H=0;H<j[t].length&&!p;++H){var I=j[t][H];I.id===v&&(I.radius+=a.multiplier,I.authors.push({id:s,name:C}),m[t][s]?m[t][s].count++:m[t][s]={id:s,name:C,count:1},p=!0)}else{var J=d[u].property_values,K=d[t].property_values;a.venueName=J["full name"]?J["full name"][0]:o,a.yearsRan=J["years ran"]?J["years ran"][0]:0;var L=K["full name"]?K["full name"][0]:o,M=K["occurs at"]?K["occurs at"][0]:o,N=K["start date"]?K["start date"][0]:o,O=K["end date"]?K["end date"][0]:o,P=K.url?K.url[0]:o,Q={name:L+": "+M,location:x,startDate:N,endDate:O,url:P,radius:5*a.multiplier,latitude:D,longitude:E,fillKey:"EVENT"};e[t]=Q,j[t]=[],m[t]={},n[t]=[b.venueId,b.year,a.venueName,a.yearsRan,L,M,D,E,N,O,P]}if(!p){var R=d[v].property_values.name?d[v].property_values.name[0]:o,S=d[v].property_values.type?d[v].property_values.type[0]:o,T={id:v,name:R,latitude:F,longitude:G,radius:a.multiplier,authors:[{id:s,name:C}],fillKey:S};j[t].push(T),m[t][s]?m[t][s].count++:m[t][s]={id:s,name:C,count:1}}k[t]||(k[t]=[]);var U={origin:{latitude:F,longitude:G},destination:{latitude:D,longitude:E}};k[t].push(U);var V=d[r].property_values.title?d[r].property_values.title[0]:o,W=h.getType(d[r].direct_concept_names),X=d[y].property_values["citation count"]?d[y].property_values["citation count"][0]:o,Y={id:r,name:V,citations:parseInt(X,10),type:W,"class":h.getClassName(W)};if(l[t]){p=!1;for(var Z=0;Z<l[t].length;++Z)l[t][Z].id===r&&(p=!0);p||l[t].push(Y)}else l[t]=[],l[t].push(Y)}}for(var $ in e)j[$].push(e[$]);a.years=Object.keys(j),a.selectedYear=a.years[0],b.year&&(a.selectedYear=b.year),a.select(a.selectedYear),a.map.plugins={bubbles:null,arc:null},a.map.pluginData={bubbles:j[a.selectedYear],arc:k[a.selectedYear]},i.setHeader(["event series id","event series year","event series name","years ran","event name","event location","latitude","longitude","start date","end date","url"]),i.setName(b.venueId+"_"+b.year),q()})}]),angular.module("itapapersApp").filter("capitalise",function(){return function(a,b){var c=b?/([^\W_]+[^\s-]*) */g:/([^\W_]+[^\s-]*)/;return a?a.replace(c,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):""}}),angular.module("itapapersApp").factory("store",["$http","$q","server","localStorageService","utils",function(a,b,c,d,e){function f(a){var b,c,d={};for(b=0;b<a.results.length;++b){c=a.results[b][0];var f=a.instances[c].property_values,g=f["citation count"][0],h=a.instances[g].property_values,i=e.getType(a.instances[c].direct_concept_names);if(!d[c]){var j=!1,k=0;if(f.variant)for(var l=0;l<f.variant.length;++l){var m=f.variant[l];d[m]&&(k=d[m].citations>k?d[m].citations:k,j=m)}var n=h["citation count"]?parseInt(h["citation count"][0],10):0;if(j)if(n>k){var o=d[j].types.slice();d[j]=null,d[c]={citations:n,index:b,types:[i].concat(o)}}else d[j].types.push(i);else d[c]={citations:n,index:b,types:[i]}}}var p=[];for(b=0;b<a.results.length;++b)c=a.results[b][0],d[c]&&d[c].index===b&&(a.results[b].push(d[c].types),p.push(a.results[b]));var q={instances:a.instances,data:p};return q}function g(){var e="academic document citations";if(d.isSupported){var g=d.get(e+"-"+D);if(g)return b.when(g);var h=c+"/ce-store/stores/"+D+"/queries/"+e+"/execute?returnInstances=true";return a.get(h).then(function(a){var b=f(a.data);return d.set(e+"-"+D,b),b},function(a){return a})}}function h(){var b=c+"/ce-store/stores/"+D+"/queries/published person citations/execute?returnInstances=true";return a.get(b).then(function(a){var b=a.data.results;return{data:b,instances:a.data.instances}},function(a){return a})}function i(){var e="event series";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/queries/"+e+"/execute";return a.get(g).then(function(a){var b=a.data.results;return d.set(e+"-"+D,b),b},function(a){return a})}}function j(){var e="projects";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/queries/"+e+"/execute?returnInstances=true";return a.get(g).then(function(a){return d.set(e+"-"+D,a.data),a.data},function(a){return a})}}function k(){var e="organisations";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/queries/"+e+"/execute?returnInstances=true";return a.get(g).then(function(a){return d.set(e+"-"+D,a.data),a.data},function(a){return a})}}function l(){var e="totals";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/queries/"+e+"/execute?returnInstances=true";return a.get(g).then(function(a){return d.set(e+"-"+D,a.data),a.data},function(a){return a})}}function m(){var e="last updated";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/queries/"+e+"/execute";return a.get(g).then(function(a){return d.set(e+"-"+D,a.data),a.data},function(a){return a})}}function n(e){if(d.isSupported){var f=d.get(e);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/instances/"+e+"?showStats=true&steps=2&style=summary&referringInstances=false&limitRelationships=is%20employed%20by,wrote,author,final%20date,citation%20count,co-author,co-author%20statistic";return a.get(g).then(function(a){return d.set(e,a.data),a.data},function(a){return a})}}function o(e){if(d.isSupported){var f=d.get(e);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/instances/"+e+"?style=summary&steps=2&referringInstances=false";return a.get(g).then(function(a){return d.set(e,a.data),a.data},function(a){return a})}}function p(e){if(d.isSupported){var f=d.get(e);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/instances/"+e;return a.get(g).then(function(a){return d.set(e,a.data),a.data},function(a){return a})}}function q(e){if(d.isSupported){var f=d.get(e);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/instances/"+e+"?style=summary&referringInstances=false&steps=3&limitRelationships=is%20located%20at,employs,citation%20count,wrote,final%20date";return a.get(g).then(function(a){return d.set(e,a.data),a.data},function(a){return a})}}function r(){var e="organisation publications";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/queries/"+e+"/execute?returnInstances=true";return a.get(g).then(function(a){return d.set(e+"-"+D,a.data),a.data},function(a){return a})}}function s(){var e="organisation details";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/queries/"+e+"/execute?showStats=false&suppressCe=true";return a.get(g).then(function(a){return d.set(e+"-"+D,a.data),a.data},function(a){return a})}}function t(){var e="person details";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/queries/"+e+"/execute?showStats=false&suppressCe=true";return a.get(g).then(function(a){return d.set(e+"-"+D,a.data),a.data},function(a){return a})}}function u(){var e="published person -> organisation";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/queries/"+e+"/execute?showStats=false&suppressCe=true";return a.get(g).then(function(a){return d.set(e+"-"+D,a.data),a.data},function(a){return a})}}function v(){var e="person -> academic document";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/queries/"+e+"/execute?showStats=false&suppressCe=true";return a.get(g).then(function(a){return d.set(e+"-"+D,a.data),a.data},function(a){return a})}}function w(){var e="academic document details";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/queries/"+e+"/execute?showStats=false&suppressCe=true";return a.get(g).then(function(a){return d.set(e+"-"+D,a.data),a.data},function(a){return a})}}function x(e){if(d.isSupported){var f=d.get(e);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/instances/"+e+"?steps=2&style=summary&referringInstances=false&limitRelationships=paper,technical%20area,citation%20count";return a.get(g).then(function(a){return d.set(e,a.data),a.data},function(a){return a})}}function y(){var e="event series details";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/queries/"+e+"/execute?returnInstances=true";return a.get(g).then(function(a){return d.set(e+"-"+D,a.data),a.data},function(a){return a})}}function z(){var e="comment";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/concepts/"+e+"/instances";return a.get(g).then(function(a){return d.set(e+"-"+D,a.data),a.data},function(a){return a})}}function A(){var e="issue";if(d.isSupported){var f=d.get(e+"-"+D);if(f)return b.when(f);var g=c+"/ce-store/stores/"+D+"/concepts/"+e+"/instances";return a.get(g).then(function(a){return d.set(e+"-"+D,a.data),a.data},function(a){return a})}}function B(){var a="voice";if(d.isSupported){var c=d.get(a);return b.when(c)}return b.when(!1)}function C(a){var b="voice";d.isSupported&&d.set(b,a)}var D="DEFAULT";return{getAcademicDocuments:g,getPublishedPeople:h,getEventSeries:i,getProjects:j,getOrganisations:k,getAuthor:n,getPaper:o,getVenue:p,getOrganisation:q,getOrganisationPublications:r,getOrganisationDetails:s,getPersonDetails:t,getPeopleOrgs:u,getPersonDocument:v,getDocumentDetails:w,getProject:x,getEventSeriesDetails:y,getComments:z,getIssues:A,getVoiceAcceptance:B,setVoiceAcceptance:C,getStatistics:l,getLastUpdated:m}}]),angular.module("itapapersApp").service("charts",function(){var a=function(a){var b,c=a.data,d=a.instances,e="undefined"!=typeof Storage,f=[],g=[];if(e&&localStorage.getItem("scatterOptions"))b=JSON.parse(localStorage.getItem("scatterOptions"));else{for(var h=0;h<c.length;++h){var i=d[c[h][0]].property_values,j=(d[c[h][1]].property_values,d[c[h][2]].property_values),k=c[h][0],l=i["ita citation count"]?i["ita citation count"][0]:0,m=i["ita h-index"]?i["ita h-index"][0]:0,n=j.type?j.type[0]:"Unknown",o=i["journal paper count"]?parseInt(i["journal paper count"][0],10):0,p=i["conference paper count"]?parseInt(i["conference paper count"][0],10):0,q=o+p,r={id:k,employer:c[h][2],name:c[h][3],totalPubs:q,citations:l,hIndex:m,industry:n,yValue:l},s={id:k,employer:c[h][2],name:c[h][3],totalPubs:q,citations:l,hIndex:m,industry:n,yValue:m},t=a.instances[k].property_values["profile picture"];t&&(r.picture=t[0],s.picture=t[0]),f.push(r),g.push(s)}b={citations:f,hIndex:g},localStorage.setItem("scatterOptions",JSON.stringify(b))}return b},b=function(a){for(var b={IND:[],AC:[],GOV:[],Unknown:[]},c=0;c<a.results.length;++c){var d=a.results[c][0],e=a.instances[d].property_values,f=e.name?e.name[0]:d,g=e.type?e.type[0]:"Unknown",h=e.employs?e.employs.length:0,i=e["paper count"]?e["paper count"]:0;b[g].push({name:f,employees:h,papers:i})}var j={name:"flare",children:[{name:"AC",children:b.AC},{name:"IND",children:b.IND},{name:"GOV",children:b.GOV}]};return j};return{getScatterData:a,getSunburstData:b}}),angular.module("itapapersApp").controller("AuthorCtrl",["$scope","$stateParams","$timeout","store","server","hudson","debug","documentTypes","utils","csv","colours",function(a,b,c,d,e,f,g,h,i,j,k){a.views=["graph","papers","co-authors","co-authors-graph"],a.currentView=a.views[0],a.journalType=h.journal,a.externalConferenceType=h.external,a.patentType=h.patent,a.internalConferenceType=h.internal,a.technicalReportType=h.technical,a.otherDocumentType=h.other,a.journalInput=a.externalInput=a.patentInput=a.internalInput=a.technicalInput=a.otherInput=a.acInput=a.indInput=a.govInput=!0;var l=null,m=h.nameMap;b.debug&&g.set(b.debug),a.$on("question:added",function(){o()});var n=function(){var c=[];if(a.currentView===a.views[0]||a.currentView===a.views[1]){for(var d in a.papersList){var e=a.papersList[d];for(var f in e.type)c.push([e.id,e.name,e.citations,e.type[f],e.venue,e.authors])}j.setData(c),j.setHeader(["paper id","paper name","citation count","paper type","venue","authors"]),j.setName(b.authorId+"_papers")}else{for(var g in a.coauthorsList){var h=a.coauthorsList[g];c.push([h.id,h.name,h.count])}j.setData(c),j.setHeader(["author id","author name","co-authored papers count"]),j.setName(b.authorId+"_coauthors")}};a.showView=function(d){a.currentView=d,d===a.views[0]&&(angular.element("svg.chart").remove(),c(function(){drawNarrativeChart(b.authorId,!0,!1,!1,a.data)},100)),n()};var o=function(){var b=f.getLatestQuestion();l&&(a[l]=!1),b&&"highlight"===b.type&&(a[b.property+"Highlight"]=!0,l=b.property+"Highlight","wrote"===b.property?a.showView(a.views[1]):"co-author"===b.property&&a.showView(a.views[2]))};a.filterPapers=function(b){return"undefined"!=typeof b.type?a.journalInput&&b.type.indexOf(m[a.journalType])>-1||a.externalInput&&b.type.indexOf(m[a.externalConferenceType])>-1||a.internalInput&&b.type.indexOf(m[a.patentType])>-1||a.patentInput&&b.type.indexOf(m[a.internalConferenceType])>-1||a.technicalInput&&b.type.indexOf(m[a.technicalReportType])>-1||a.otherInput&&b.type.indexOf(m[a.otherDocumentType])>-1:void 0},a.width=window.innerWidth,a.height=window.innerHeight;var p=angular.element("#narrative-chart"),q=a.height-215;p.css("height",q-10+"px"),p.css("max-height",q-10+"px"),p=angular.element("#authors-publications-list"),p.css("height",q+"px"),p.css("max-height",q+"px"),p=angular.element("#authors-publications-list .results-list"),p.css("height","calc(100% - 50px)"),p=angular.element("#authors-coauthors-list"),p.css("height",q+"px"),p.css("max-height",q+"px"),p=angular.element("#authors-coauthors-list .results-list"),p.css("height","calc(100% - 50px)"),p=angular.element("#authors-coauthors-chart"),p.css("height",q+"px"),p.css("max-height",q+"px"),d.getAuthor(b.authorId).then(function(c){a.data=c;var d="Unknown",e=c.structured_response.main_instance.property_values,f=c.structured_response.related_instances;if(a.authorId=b.authorId,a.author=e["full name"]?e["full name"][0]:d,a.employer={},e["is employed by"]){var g=f[e["is employed by"][0]];g&&(g.property_values.name?a.employer={id:g._id,name:g.property_values.name[0]}:a.employer={id:g._id,name:g._id},a.type=g.property_values.type[0])}a.perfectPapers=e["perfect paper count"]?parseInt(e["perfect paper count"][0],10):0,a.journalPapers=e["journal paper count"]?parseInt(e["journal paper count"][0],10):0,a.externalPapers=e["external paper count"]?parseInt(e["external paper count"][0],10):0,a.patents=e["patent count"]?parseInt(e["patent count"][0],10):0,a.internalPapers=e["internal paper count"]?parseInt(e["internal paper count"][0],10):0,a.technicalReports=e["technical report count"]?parseInt(e["technical report count"][0],10):0,a.otherDocuments=e["other document count"]?parseInt(e["other document count"][0],10):0,a.totalPublications=e["total publication count"]?parseInt(e["total publication count"][0],10):0;var h=[{label:m[a.journalType],value:a.journalPapers},{label:m[a.externalConferenceType],value:a.externalPapers},{label:m[a.patentType],value:a.patents},{label:m[a.internalConferenceType],value:a.internalPapers},{label:m[a.technicalReportType],value:a.technicalReports},{label:m[a.otherDocumentType],value:a.otherDocuments}];if(a.scholarLink="https://scholar.google.co.uk/scholar?q="+e["full name"][0]+"&btnG=&hl=en&as_sdt=0%2C5",e["citation count"]){var j=f[e["citation count"][0]].property_values,k=j.url?j.url[0]:null,l=e["ita citation count"]?e["ita citation count"][0]:0,p=e["ita h-index"]?e["ita h-index"][0]:0;a.citationCount={url:k,count:l},a.hIndex={url:k,index:p}}var q,s;a.papersList=[];var t={};for(q=0;q<e.wrote.length;++q){var u=e.wrote[q],v=f[u],w=i.getType(v.direct_concept_names),x=v.property_values,y=x["citation count"],z=0;if(!t[u]){var A=!1,B=0;if(x.variant)for(s=0;s<x.variant.length;++s){var C=x.variant[s];t[C]&&(B=t[C].citations>B?t[C].citations:B,A=C)}if(y){var D=f[y].property_values;if(z=D["citation count"]?parseInt(D["citation count"][0],10):0,A)if(z>B){var E=t[A].types.slice();t[A]=null,t[u]={citations:z,index:q,title:x.title?x.title[0]:d,noteworthy:x["noteworthy reason"]?x["noteworthy reason"][0]:null,types:[w].concat(E),venue:x.venue?x.venue[0]:x["old venue"]?x["old venue"][0]:"",authors:x["original authors string"]?x["original authors string"][0]:"",weight:x.weight?x.weight[0]:-1}}else t[A].types.push(w);else t[u]={citations:z,index:q,title:x.title?x.title[0]:d,noteworthy:x["noteworthy reason"]?x["noteworthy reason"][0]:null,types:[w],venue:x.venue?x.venue[0]:x["old venue"]?x["old venue"][0]:"",authors:x["original authors string"]?x["original authors string"][0]:"",weight:x.weight?x.weight[0]:-1}}}}for(q=0;q<e.wrote.length;++q){var F=e.wrote[q],G=t[F];if(G&&G.index===q){var H={id:F,name:G.title,noteworthy:G.noteworthy,citations:G.citations,type:i.sortTypes(G.types),venue:G.venue,authors:G.authors,"class":[],weight:G.weight};for(s=0;s<H.type.length;++s)H["class"].push(i.getClassName(H.type[s]));a.papersList.push(H)}}for(a.coauthorsList=[],a.nodes=[],a.nodes.push({id:a.authorId,name:a.author,group:a.type,count:a.totalPublications}),q=0;q<e["co-author statistic"].length;++q){var I,J=e["co-author statistic"][q],K=f[J].property_values,L=K["co-author"],M=L[0]===a.authorId?L[1]:L[0],N=K["co-author count"]?parseInt(K["co-author count"][0],10):0,O=f[M].property_values,P=O["full name"]?O["full name"][0]:d,Q=O["is employed by"]?O["is employed by"][0]:d;I=Q!==d?f[Q].property_values.type[0]:d,a.coauthorsList.push({id:M,name:P,count:N});var R=O["co-author statistic"],S=[];for(s in R){var T=f[R[s]].property_values,U=!1;for(var V in T["co-author"])T["co-author"][V]===a.authorId&&(U=!0);U||S.push({id:R[s],authors:T["co-author"],count:T["co-author count"][0]})}a.nodes.push({id:M,name:P,group:I,count:N,links:S})}a.currentView===a.views[0]&&drawNarrativeChart(b.authorId,!0,!1,!1,c),n(),r(h),o()});var r=function(b){var c=.25*(a.width-200),d=a.height-500;(a.width<1e3||300>d)&&(c=300,d=300);var e=Math.min(c,d)/2,f=c/6,g=18,h=5,i=d3.scale.ordinal().range(k.papers),j=d3.select("#pie-chart").append("svg").attr("width",c).attr("height",d).attr("class","pie-svg").append("g").attr("transform","translate("+c/2+","+d/2+")"),l=d3.svg.arc().innerRadius(e-f).outerRadius(e),m=d3.layout.pie().value(function(a){return a.value}).sort(null),n=(j.selectAll("path").data(m(b)).enter().append("path").attr("d",l).attr("fill",function(a){return i(a.data.label)}),[]),o=0,p=j.selectAll(".legend").data(i.domain()).enter().append("g").attr("class","legend").attr("display",function(a){for(var c=0;c<b.length;++c)if(b[c].label===a&&(n.push(b[c].value),!b[c].value))return"none"}).attr("transform",function(a,b){o=0===n[b]?o+1:o;var c=g+h,d=c*i.domain().length/2,e=-2.5*g,f=(b-o)*c-d;return"translate("+e+","+f+")"});p.append("rect").attr("width",g).attr("height",g).style("fill",i).style("stroke",i),p.append("text").attr("x",g+h).attr("y",g-h).attr("class","pie-legend-text").text(function(a){return a})};a.addCitations=function(){var c=prompt("Please enter the citation count, h-index and URL separated with spaces","123 13 www.url.com");if(null!==c){var d,f=e+"/ce-store/stores/DEFAULT/sources/generalCeForm?showStats=true&action=save",g=c.split(" "),h=new Date,i=h.getDate()+"/"+(h.getMonth()+1)+"/"+h.getFullYear();if(3!==g.length)d="the person citation count 'citation:"+b.authorId+"-01'\n  has '"+i+"' as date checked.",d+="\n\nthe published person '"+b.authorId+"'\n  has the person citation count 'citation:"+b.authorId+"-01' as citation count.";else{var j=g[0],k=g[1],l=g[2];d="the person citation count 'citation:"+b.authorId+"-01'\n  has '"+l+"' as url and\n  has '"+i+"' as date checked and\n  has '"+j+"' as citation count and\n  has '"+k+"' as h-index.",d+="\n\nthe published person '"+b.authorId+"'\n  has the person citation count 'citation:"+b.authorId+"-01' as citation count.",a.citationCount={url:l,count:j},a.hIndex={url:l,index:k}}console.log(d),$.ajax({type:"POST",url:f,data:d,contentType:"text/plain;charset=UTF-8"})}}}]);var link_width=1.8,link_gap=2,node_width=10,color=["#5596e6","#ff7f0e","#2ca02c","#d62728"],raw_chart_width=1200,group_gap=0,text_height=8,per_width=.3,name_shift=10,name_bg=!0,equal_scenes=!1,curvature=.5,longest_name=130,authorIndex={},drag_offset=0,opacity={opaqueNodes:{opacity:1,transition:"opacity .25s ease-in-out","-moz-transition":"opacity .25s ease-in-out","-webkit-transition":"opacity .25s ease-in-out"},opaqueLinks:{"stroke-opacity":.6,transition:"opacity .25s ease-in-out","-moz-transition":"opacity .25s ease-in-out","-webkit-transition":"opacity .25s ease-in-out"},translucentNodes:{opacity:.1,transition:"opacity .25s ease-in-out","-moz-transition":"opacity .25s ease-in-out","-webkit-transition":"opacity .25s ease-in-out"},translucentLinks:{"stroke-opacity":.1,transition:"opacity .25s ease-in-out","-moz-transition":"opacity .25s ease-in-out","-webkit-transition":"opacity .25s ease-in-out"}};angular.module("itapapersApp").controller("PaperCtrl",["$scope","$stateParams","$http","store","hudson","server","debug","documentTypes","utils","csv",function(a,b,c,d,e,f,g,h,i,j){a.journalType=h.journal,a.externalConferenceType=h.external,a.internalConferenceType=h.internal,a.technicalReportType=h.technical,a.otherDocumentType=h.other,a.conferenceType="conference document";var k=null,l=h.nameMap;b.debug&&g.set(b.debug),a.$on("question:added",function(){m()}),a.show=function(b){a.source=a[b+"Source"]};var m=function(){var b=e.getLatestQuestion();k&&(a[k]=!1),b&&"highlight"===b.type&&(a[b.property+"Highlight"]=!0,k=b.property+"Highlight")};a.width=window.innerWidth,a.height=window.innerHeight;var n=angular.element("#paper-img"),o=a.height-190;n.css("max-height",o+"px");var p=angular.element("#paper-abstract");o=a.height-600,p.css("max-height",o+"px"),d.getPaper(b.paperId).then(function(c){var e=0,g="Unknown",k=[],n=c.main_instance.direct_concept_names,o=c.main_instance.property_values,p=c.related_instances;if(a.orderedAuthors=[],o.author)for(e=0;e<o.author.length;++e){var q,r,s=p[o.author[e]].property_values;s["author person"]?(q=s["author person"]?s["author person"][0]:"",r=p[s["author person"][0]].property_values["full name"][0]):s["original author string"]?(q="",r=s["original author string"][0]):(q="",r=o.author[e]);var t=99;a.orderedAuthors.push({index:s["author index"]?s["author index"][0]:t,id:q,name:r})}if(a.orderedAuthors.sort(function(a,b){return a.index-b.index}),a.title=o.title?o.title[0]:g,a.noteworthy=o["noteworthy reason"]?o["noteworthy reason"][0]:null,a.paperSource=o["paper thumbnail"]?f+o["paper thumbnail"][0]:null,a.presentationSource=o["presentation thumbnail"]?f+o["presentation thumbnail"][0]:null,a.posterSource=o["poster thumbnail"]?f+o["poster thumbnail"][0]:null,a.source=a.paperSource,a.scholarLink="https://scholar.google.co.uk/scholar?q=%22"+o.title[0]+"%22&btnG=&hl=en&as_sdt=0%2C5",o["citation count"]){var u=p[o["citation count"][0]].property_values;u.url&&u["citation count"]&&(a.citationCount={url:u.url[0],count:u["citation count"][0]})}if(a.paperType=i.getType(n),a.paperClass=i.getClassName(a.paperType),a.paperType===l[a.externalConferenceType]||a.paperType===l[a.internalConferenceType]){if(o.venue){var v=o.venue[0],w=v.split(" ");a.showVenue=!0,a.venue={id:w[0],year:w[1],name:o.venue[0]};var x=p[v].property_values["occurs at"];d.getVenue(x).then(function(b){var c=b.property_values,d={latitude:c.latitude[0],longitude:c.longitude[0]};a.map={center:d,zoom:8},a.marker={id:b._id,coords:d}})}}else if(a.paperType===l[a.journalType]);else if(a.paperType===l[a.otherDocumentType])for(var y=0;y<n.length;++y)n.indexOf(h.invitedTalk)>-1?a.paperType=l[h.invitedTalk]:n.indexOf(h.bookChapter)>-1?a.paperType=l[h.bookChapter]:n.indexOf(h.phdThesis)>-1?a.paperType=l[h.phdThesis]:n.indexOf(h.poster)>-1?a.paperType=l[h.poster]:n.indexOf(h.workshop)>-1?a.paperType=l[h.workshop]:n.indexOf(h.softwareAsset)>-1?a.paperType=l[h.softwareAsset]:n.indexOf(h.demonstration)>-1&&(a.paperType=l[h.demonstration]);o["old venue"]&&(a.oldVenue=o["old venue"][0]);var z=o["final date"]?p[o["final date"][0]].property_values:null;if(z){if(z["original date string"])a.published=z["original date string"][0];else if(z.month&&z.year){var A;A=z.day?new Date(z.year,z.month-1,z.day):new Date(z.year,z.month-1),a.published=A.getDate()+"/"+(A.getMonth()+1)+"/"+A.getFullYear()}a.year=z.year[0]}else a.published=g,a.year=g;if(o.project&&(a.project={id:o.project[0],name:p[o.project[0]].property_values.name[0]}),o["abstract"]&&(a["abstract"]=o["abstract"][0]),a.variants=[],o.variant)for(var y=0;y<o.variant.length;++y){var B=o.variant[y],C=i.getType(p[B].direct_concept_names),D={id:B,name:p[B].property_values.title[0],className:i.getClassName(C)};a.variants.push(D)}o["paper file"]&&(a.paperDownloadUrl=f+o["paper file"][0]),o["poster file"]&&(a.posterDownloadUrl=f+o["poster file"][0]),o["presentation file"]&&(a.presentationDownloadUrl=f+o["presentation file"][0]);for(var E in a.orderedAuthors){var F=a.orderedAuthors[E],G=a.project?a.project.id:"",H=a.project?a.project.name:"",I=a.citationCount?a.citationCount.url:"",J=a.citationCount?a.citationCount.count:"",K=a.venue?a.venue.id:a["old venue"],L=a.venue?a.venue.year:"",M=a.venue?a.venue.name:"";k.push([b.paperId,a.title,a.published,F.id,F.name,G,H,I,J,a.paperType,K,L,M])}j.setData(k),j.setHeader(["id","title","publish date","author id","author name","project id","project name","citation url","citation count","paper type","venue id","venue year","venue name"]),j.setName(b.paperId),m()});var q=function(a){var b=null;return null!==a?(b=a,b=b.replace(/\\/g,"\\\\"),b=b.replace(new RegExp("'","g"),"\\'"),b=b.replace(new RegExp("‘","g"),"\\‘"),b=b.replace(new RegExp("’","g"),"\\’"),b=b.replace(new RegExp("“","g"),"\\“"),b=b.replace(new RegExp("”","g"),"\\”"),b=b.replace(/(?:\r\n|\r|\n)/g," ")):b="",b};a.addAbstract=function(){var c=prompt("Please enter the abstract","some abstract text");if(null!==c){var d=f+"/ce-store/stores/DEFAULT/sources/generalCeForm?showStats=true&action=save",e="the academic document '"+b.paperId+"' has '"+q(c)+"' as abstract.";a["abstract"]=c,console.log(e),$.ajax({type:"POST",url:d,data:e,contentType:"text/plain;charset=UTF-8"})}},a.addCitationCount=function(){var c=prompt("Please enter the citation count","42");if(null!==c){var d=f+"/ce-store/stores/DEFAULT/sources/generalCeForm?showStats=true&action=save",e=new Date,g=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear(),h="the paper citation count 'citation:"+b.paperId+"-01'\n  has '"+a.scholarLink+"' as url and\n  has '"+g+"' as date checked and\n  has '"+c+"' as citation count.",i="\n\nthe academic document '"+b.paperId+"'\n  has the paper citation count 'citation:"+b.paperId+"-01' as citation count.";a.citationCount={url:a.scholarLink,count:c},console.log(h+i),$.ajax({type:"POST",url:d,data:h+" "+i,contentType:"text/plain;charset=UTF-8"})}}}]),angular.module("itapapersApp").constant("server","http://localhost:8080"),angular.module("itapapersApp").controller("ResultsCtrl",["$scope","$stateParams","hudson","debug",function(a,b,c,d){a.qa=c.getLatestQuestion(),a.listLength=25,b.debug&&d.set(b.debug),"list"===a.qa.type&&(a.list=[{name:"Don",value:"12"}])}]),angular.module("itapapersApp").controller("OrganisationCtrl",["$scope","$stateParams","$document","store","hudson","debug","documentTypes","utils","csv","colours",function(a,b,c,d,e,f,g,h,i,j){a.views=["chart","list","authors"],a.currentView=a.views[0],a.journalType=g.journal,a.externalConferenceType=g.external,a.patentType=g.patent,a.internalConferenceType=g.internal,a.technicalReportType=g.technical,a.otherDocumentType=g.other,a.journalInput=a.externalInput=a.patentInput=a.internalInput=a.technicalInput=a.otherInput=!0,a.tipOpen=!1;var k=null,l=g.nameMap;b.debug&&f.set(b.debug),a.$on("question:added",function(){m()}),a.showView=function(b){a.currentView=b};var m=function(){var b=e.getLatestQuestion();k&&(a[k]=!1),b&&"highlight"===b.type&&(a[b.property+"Highlight"]=!0,k=b.property+"Highlight")};a.hideTips=function(){angular.element(".d3-tip").css("opacity",0),angular.element(".d3-tip").css("display","none"),a.tipOpen=!1},a.filterPapers=function(b){return"undefined"!=typeof b.type?a.journalInput&&b.type.indexOf(l[a.journalType])>-1||a.externalInput&&b.type.indexOf(l[a.externalConferenceType])>-1||a.patentInput&&b.type.indexOf(l[a.patentType])>-1||a.internalInput&&b.type.indexOf(l[a.internalConferenceType])>-1||a.technicalInput&&b.type.indexOf(l[a.technicalReportType])>-1||a.otherInput&&b.type.indexOf(l[a.otherDocumentType])>-1:void 0},a.width=window.innerWidth,a.height=window.innerHeight;var n=a.height-270,o=angular.element("#org-papers-list");o.css("height",n+20+"px"),o=angular.element("#org-papers-list .results-list"),o.css("max-height","calc(100% - 75px)"),o=angular.element("#org-authors-list"),o.css("height",n+"px"),o=angular.element("#org-authors-list .results-list"),o.css("max-height","calc(100% - 55px)"),d.getOrganisation(b.organisationId).then(function(c){var d={};a.papers={},a.variants={},a.employees={};var e,f,g=c.main_instance.property_values,j=c.related_instances;a.name=g.name?g.name[0]:null,a.industry=g.type?g.type[0]:null,a.country=g["is located at"]?g["is located at"][0]:null,a.journalPapers=g["journal paper count"]?parseInt(g["journal paper count"][0],10):0,a.externalPapers=g["external paper count"]?parseInt(g["external paper count"][0],10):0,a.patents=g["patent count"]?parseInt(g["patent count"][0],10):0,a.internalPapers=g["internal paper count"]?parseInt(g["internal paper count"][0],10):0,a.technicalReports=g["technical report count"]?parseInt(g["technical report count"][0],10):0,a.otherDocuments=g["other document count"]?parseInt(g["other document count"][0],10):0,a.totalPublications=g["paper count"]?parseInt(g["paper count"][0],10):0;for(var k=g.employs,n={},o=[],r=0;r<k.length;++r){var s=k[r],t=j[s],u=t.property_values,v=u["full name"]?u["full name"][0]:null,w=(u["journal paper count"]?parseInt(u["journal paper count"][0],10):0,u["external paper count"]?parseInt(u["external paper count"][0],10):0,u["patent count"]?parseInt(u["patent count"][0],10):0,u["internal paper count"]?parseInt(u["internal paper count"][0],10):0,u["total publication count"]?parseInt(u["total publication count"][0],10):0);a.employees[s]={id:s,name:v,value:w};var x=u.wrote;if(x){var y,z;for(y=0;y<x.length;++y){var A=x[y],B=j[A],C=B.property_values,D=C.title?C.title[0]:null,E=h.getType(B.direct_concept_names),F=0;if(!n[A]){var G=!1,H=0;if(C.variant)for(z=0;z<C.variant.length;++z){var I=C.variant[z];n[I]&&(H=n[I].citations>H?n[I].citations:H,G=I)}var J=C["citation count"]?C["citation count"][0]:null;if(J){var K=j[J],L=K.property_values;if(F=L["citation count"]?parseInt(L["citation count"][0],10):0,G)if(F>H){var M=n[G].types.slice();n[G]=null,n[A]={citations:F,index:y,title:D,noteworthy:C["noteworthy reason"]?C["noteworthy reason"][0]:null,types:[E].concat(M),venue:C.venue?C.venue[0]:C["old venue"]?C["old venue"][0]:"",authors:C["original authors string"]?C["original authors string"][0]:"",weight:C.weight?C.weight[0]:-1}}else n[G].types.push(E);else n[A]={citations:F,index:y,title:D,noteworthy:C["noteworthy reason"]?C["noteworthy reason"][0]:null,types:[E],venue:C.venue?C.venue[0]:C["old venue"]?C["old venue"][0]:"",authors:C["original authors string"]?C["original authors string"][0]:"",weight:C.weight?C.weight[0]:-1};var N=C["final date"][0],O=j[N].property_values.month,P=j[N].property_values.year;O||(O="1");var Q=new Date(P,O-1);(!e||e>Q)&&(e=Q),(!f||Q>f)&&(f=Q),d[Q]||(d[Q]={},d[Q][l[a.journalType]]=[],d[Q][l[a.externalConferenceType]]=[],d[Q][l[a.patentType]]=[],d[Q][l[a.internalConferenceType]]=[],d[Q][l[a.technicalReportType]]=[],d[Q][l[a.otherDocumentType]]=[]),d[Q][E].push({id:A,title:D,citations:F})}}}for(y=0;y<x.length;++y){var R=x[y],S=n[R];if(S&&S.index===y){
var T={id:R,name:S.title,noteworthy:S.noteworthy,value:S.citations,type:h.sortTypes(S.types),venue:S.venue,authors:S.authors,"class":[],weight:S.weight};for(z=0;z<T.type.length;++z)T["class"].push(h.getClassName(T.type[z])),o.push([T.id,T.name,T.value,T.type[z],T.venue,T.authors]);a.papers[R]=T}}}}if(i.setData(o),i.setHeader(["paper id","paper name","citation count","paper type","venue","authors"]),i.setName(b.organisationId),e&&f){for(var U=e;U.getTime()!==f.getTime();){d[U]||(d[U]={},d[U][l[a.journalType]]=[],d[U][l[a.externalConferenceType]]=[],d[U][l[a.patentType]]=[],d[U][l[a.internalConferenceType]]=[],d[U][l[a.technicalReportType]]=[],d[U][l[a.otherDocumentType]]=[]);var V=U.getMonth();if(parseInt(V,10)<11)U.setMonth(V+1);else{var W=U.getFullYear();U.setMonth(0),U.setFullYear(parseInt(W,10)+1)}}var X=[];for(var Q in d)X.push({date:Q,journal:d[Q][l[a.journalType]],external:d[Q][l[a.externalConferenceType]],patent:d[Q][l[a.patentType]],internal:d[Q][l[a.internalConferenceType]],technical:d[Q][l[a.technicalReportType]],other:d[Q][l[a.otherDocumentType]]});var Y=[{label:l[a.journalType],value:a.journalPapers},{label:l[a.externalConferenceType],value:a.externalPapers},{label:l[a.patentType],value:a.patents},{label:l[a.internalConferenceType],value:a.internalPapers},{label:l[a.technicalReportType],value:a.technicalReports},{label:l[a.otherDocumentType],value:a.otherDocuments}];q(X),p(Y),m()}});var p=function(b){var c=.25*(a.width-200),d=a.height-500;(a.width<1e3||300>d)&&(c=300,d=300);var e=Math.min(c,d)/2,f=c/6,g=18,h=5,i=d3.scale.ordinal().range(j.papers),k=d3.select("#pie-chart").append("svg").attr("width",c).attr("height",d).attr("class","pie-svg").append("g").attr("transform","translate("+c/2+","+d/2+")"),l=d3.svg.arc().innerRadius(e-f).outerRadius(e),m=d3.layout.pie().value(function(a){return a.value}).sort(null),n=(k.selectAll("path").data(m(b)).enter().append("path").attr("d",l).attr("fill",function(a,b){return i(a.data.label)}),[]),o=0,p=k.selectAll(".legend").data(i.domain()).enter().append("g").attr("class","legend").attr("display",function(a){for(var c=0;c<b.length;++c)if(b[c].label===a&&(n.push(b[c].value),!b[c].value))return"none"}).attr("transform",function(a,b){o=0===n[b]?o+1:o;var c=g+h,d=c*i.domain().length/2,e=-2.5*g,f=(b-o)*c-d;return"translate("+e+","+f+")"});p.append("rect").attr("width",g).attr("height",g).style("fill",i).style("stroke",i),p.append("text").attr("x",g+h).attr("y",g-h).attr("class","pie-legend-text").text(function(a){return a})},q=function(b){var d={top:20,right:20,bottom:50,left:40},e=.75*(a.width-150-d.left-d.right),f=a.height-370-d.top-d.bottom,g=d3.scale.ordinal().rangeRoundBands([0,e],.1),h=d3.scale.linear().rangeRound([f,0]),i=d3.scale.ordinal().range(j.papers),k=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],l=d3.svg.axis().scale(g).tickFormat(function(a,b){var c=new Date(a);return g.domain().length<12?k[c.getMonth()]+" "+c.getFullYear():0===c.getMonth()?c.getFullYear():void 0}).orient("bottom"),m=d3.svg.axis().scale(h).orient("left"),n=d3.tip().attr("class","d3-tip dark-tip").offset([-10,0]).html(function(a){for(var b="<ul class='org-tip-content results-list'>",c=0;c<a.papers.length;++c){var d=a.papers[c].id,e=a.papers[c].title;b+="<li><a class='list-name' href='paper/"+d+"'>"+e+"</a></li>"}return b+="</ul>"}),o=d3.select("#bar-chart").append("svg").attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom).attr("class","organisation-bar-chart").append("g").attr("transform","translate("+d.left+","+d.top+")");o.call(n),i.domain(d3.keys(b[0]).filter(function(a){return"date"!==a}));var p={journal:0,external:0,patent:0,internal:0,technical:0,other:0};b.forEach(function(a){var b=0;a.papers=i.domain().map(function(c){return{name:c,y0:b,y1:b+=+a[c].length,papers:a[c].sort(function(a,b){return b.citations-a.citations})}}),a.total=a.papers[a.papers.length-1].y1,p.journal+=a.journal.length,p.external+=a.external.length,p.patent+=a.patent.length,p.internal+=a.internal.length,p.technical+=a.technical.length,p.other+=a.other.length}),b.sort(function(a,b){var c=new Date(a.date),d=new Date(b.date);return c-d}),g.domain(b.map(function(a){return a.date})),h.domain([0,d3.max(b,function(a){return a.total})]),o.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(l).selectAll("text").attr("x",-11).attr("y",10).style("text-anchor","start"),o.append("g").attr("class","y axis").call(m).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("No. of papers");var q=o.selectAll(".bar").data(b).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+g(a.date)+",0)"});q.selectAll("rect").data(function(a){return a.papers}).enter().append("rect").attr("width",g.rangeBand()).attr("y",function(a){return h(a.y1)}).attr("height",function(a){return h(a.y0)-h(a.y1)}).style("fill",function(a){return i(a.name)}).on("click",function(b){a.tipOpen||(angular.element(".d3-tip").css("display","inline"),n.show(b),a.tipOpen=!a.tipOpen)}),c.mouseup(function(b){var c=angular.element("d3-tip");a.tipOpen&&!c.is(b.target)&&a.hideTips()}),d3.selectAll("g.x.axis g.tick line").attr("y2",function(a){var b=new Date(a);return 0===b.getMonth()?6:0});var r=0,s=o.selectAll(".legend").data(i.domain().slice()).enter().append("g").attr("class","legend").attr("display",function(a){return p[a]?void 0:"none"}).attr("transform",function(a,b){return r=0===p[a]?r+1:r,"translate(0,"+20*(b-r)+")"});s.append("rect").attr("x",e-18).attr("width",18).attr("height",18).style("fill",i),s.append("text").attr("x",e-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return"journal"===a?"Journal":"external"===a?"External Conference":"patent"===a?"Patent":"internal"===a?"Internal Conference":"technical"===a?"Technical Report":"other"===a?"Other Document":void 0})}}]),angular.module("itapapersApp").controller("ProjectCtrl",["$scope","$stateParams","store","debug","hudson","documentTypes","utils","csv",function(a,b,c,d,e,f,g,h){a.journalType=f.journal,a.externalConferenceType=f.external,a.internalConferenceType=f.internal,a.technicalReportType=f.technical,a.otherDocumentType=f.other,a.journalInput=a.externalInput=a.internalInput=a.technicalInput=a.otherInput=!0;var i,j="Unknown",k=f.nameMap;b.debug&&d.set(b.debug),a.$on("question:added",function(){l()});var l=function(){var b=e.getLatestQuestion();i&&(a[i]=!1),b&&"highlight"===b.type&&(a[b.property+"Highlight"]=!0,i=b.property+"Highlight")};a.filterPapers=function(b){return"undefined"!=typeof b.type?a.journalInput&&b.type.indexOf(k[a.journalType])>-1||a.externalInput&&b.type.indexOf(k[a.externalConferenceType])>-1||a.internalInput&&b.type.indexOf(k[a.internalConferenceType])>-1||a.technicalInput&&b.type.indexOf(k[a.technicalReportType])>-1||a.otherInput&&b.type.indexOf(k[a.otherDocumentType])>-1:void 0},a.width=window.innerWidth,a.height=window.innerHeight;var m=angular.element("#publications-results-list"),n=a.height-335;m.css("max-height",n+"px"),c.getProject(b.projectId).then(function(c){var d=c.main_instance.property_values,e=c.related_instances,f={},i=[];if(a.name=d.name?d.name[0]:j,a.technicalArea=d["technical area"]?e[d["technical area"][0]].property_values.name[0]:j,a.publications=[],d.paper){var k,m;for(k=0;k<d.paper.length;++k){var n=d.paper[k],o=e[n],p=o.property_values,q=g.getType(o.direct_concept_names),r=o.property_values["citation count"],s=0;if(!f[n]){var t=!1,u=0;if(p.variant)for(m=0;m<p.variant.length;++m){var v=p.variant[m];f[v]&&(u=f[v].citations>u?f[v].citations:u,t=v)}if(r){var w=e[r[0]].property_values;if(s=w["citation count"]?parseInt(w["citation count"][0],10):0,t)if(s>u){var x=f[t].types.slice();f[t]=null,f[n]={citations:s,index:k,title:p.title?p.title[0]:j,types:[q].concat(x),venue:p.venue?p.venue[0]:p["old venue"]?p["old venue"][0]:"",authors:p["original authors string"]?p["original authors string"][0]:""}}else f[t].types.push(q);else f[n]={citations:s,index:k,title:p.title?p.title[0]:j,types:[q],venue:p.venue?p.venue[0]:p["old venue"]?p["old venue"][0]:"",authors:p["original authors string"]?p["original authors string"][0]:""}}}}for(k=0;k<d.paper.length;++k){var y=d.paper[k],z=f[y];if(z&&z.index===k){var A={id:y,name:z.title,citations:z.citations,type:g.sortTypes(z.types),venue:z.venue,authors:z.authors,"class":[]};for(m=0;m<A.type.length;++m)A["class"].push(g.getClassName(A.type[m])),i.push([A.id,A.name,A.value,A.type[m],A.venue,A.authors]);a.publications.push(A)}}}h.setData(i),h.setHeader(["paper id","paper name","citation count","paper type","venue","authors"]),h.setName(b.projectId),l()})}]),angular.module("itapapersApp").factory("hudson",["$http","$location","$rootScope","server",function(a,b,c,d){var e=[],f=d+"/ITAHudson/QuestionAnalyser?debug=true",g={academicDocument:"academic document",person:"person",event:"event",eventSeries:"event series",organisation:"organisation",project:"ITA project"},h=function(a,b,d){var f;"highlight"===b?f={question:a,type:b,property:d}:"redirect"===b&&(f={question:a,type:b}),e.push(f),c.$broadcast("question:added")},i=function(a){return a.direct_concept_names.indexOf(g.academicDocument)>-1||a.direct_concept_names.indexOf(g.person)>-1||a.direct_concept_names.indexOf(g.eventSeries)>-1||a.direct_concept_names.indexOf(g.event)>-1||a.direct_concept_names.indexOf(g.organisation)>-1||a.direct_concept_names.indexOf(g.project)>-1},j=function(a,b){var c;return a===g.academicDocument?c="/paper/"+b._id:a===g.person?c="/author/"+b._id:a===g.eventSeries?c="/venue/"+b._id+"/":a===g.event?c="/venue/"+b.property_values["is part of"][0]+"/"+b._id:a===g.organisation?c="/organisation/"+b._id:a===g.project&&(c="/project/"+b._id),c},k=function(a){var c,d,e,f,k,l;for(var m in a.properties)a.properties[m].length>0&&(c=a.properties[m][0].property_name,d=a.properties[m][0].domain_name,console.log("prop name: "+c),console.log("domain name: "+d),d.indexOf(g.academicDocument)>-1?f=g.academicDocument:d.indexOf(g.person)>-1?f=g.person:d.indexOf(g.eventSeries)>-1?f=g.eventSeries:d.indexOf(g.event)>-1?f=g.event:d.indexOf(g.organisation)>-1?f=g.organisation:d.indexOf(g.project)>-1&&(f=g.project),console.log("type: "+f));if(c){for(k in a.instances)for(var n=0;n<a.instances[k].length;++n)if(a.instances[k][n].direct_concept_names.indexOf(f)>-1||a.instances[k][n].inherited_concept_names.indexOf(f)>-1){e=a.instances[k][n];break}l=j(f,e),b.url(l),h(a.question_text,"highlight",c.replace(/ /g,"_"))}else{console.log("redirect");var o=a.answer_instances?a.answer_instances:a.instances;for(k in o){var p;if(p=o[k][0]?o[k][0]:o[k],i(p)){e=p;break}}e&&(e.direct_concept_names.indexOf(g.academicDocument)>-1?l="/paper/"+e._id:e.direct_concept_names.indexOf(g.person)>-1?l="/author/"+e._id:e.direct_concept_names.indexOf(g.eventSeries)>-1?l="/venue/"+e._id+"/":e.direct_concept_names.indexOf(g.event)>-1?l="/venue/"+e.property_values["is part of"][0]+"/"+e._id:e.direct_concept_names.indexOf(g.organisation)>-1?l="/organisation/"+e._id:e.direct_concept_names.indexOf(g.project)>-1&&(l="/project/"+e._id),b.url(l),h(a.question_text,"redirect"))}},l=function(b){a.post(f,b).then(function(a){console.log(a),k(a.data)},function(a){console.log("failed: "+a)})},m=function(){return e.length>0?e.pop():void 0};return{askQuestion:l,getLatestQuestion:m}}]),angular.module("itapapersApp").directive("itaHeader",["$uibModal","$location","$sce","localStorageService","debug","server","csv",function(a,b,c,d,e,f,g){return{templateUrl:"views/ita-header.html",restrict:"E",link:function(h){h.$on("debug",function(){h.debug="true"===e.getState()}),h.getCSVData=function(){return g.getData()},h.getCSVHeader=function(){return g.getHeader()},h.csvFileName=function(){return g.getName()},h.tooltipHTML=function(){return c.trustAsHtml("Download "+h.csvFileName())},h.addComment=function(c){var d=b.url(),e=d.split("/");h.page=e[1],e[2]&&(h.id=e[2].split("?")[0]);var f=a.open({animation:h.animationsEnabled,templateUrl:"views/add-comment.html",controller:"AddCommentCtrl",size:c,resolve:{page:function(){return h.page},id:function(){return h.id}}}),g=function(a){return"paper"===a?"academic document":"venue"===a?"event series":"project"===a?"ITA project":"author"===a?"person":a};f.result.then(function(a){var b=a.user?a.user:"default",c="the comment 'com_{uid}'\n  has '"+d+"' as url and\n";h.id&&(c+="  applies to the "+g(h.page)+" '"+h.id+"' and\n"),c+="  has '"+a.comment+"' as text and\n  was raised by the user '"+b+"'.",console.log(c),i(c)})},h.reset=function(){d.clearAll(),localStorage.clear()},h.refresh=function(){"/"===b.url()&&location.reload()};var i=function(a){var b=f+"/ce-store/stores/DEFAULT/sources/generalCeForm?showStats=true&action=save";$.ajax({type:"POST",url:b,data:a,contentType:"text/plain;charset=UTF-8"})}}}}]),angular.module("itapapersApp").directive("itaFooter",["$location","$uibModal","hudson","store",function(a,b,c,d){return{templateUrl:"views/ita-footer.html",restrict:"E",link:function(a){a.question="",a.submit=function(){console.log("submit"),console.log(a.question),c.askQuestion(a.question)};var e,f=function(){console.log("reset listener"),e=new webspeech.Listener,e.listen("en",function(b){console.log(b),a.question=b,angular.element("#question-box")[0].value=b,c.askQuestion(b)})};a.resetListener=function(){d.getVoiceAcceptance().then(function(a){if(a)f();else{var c=b.open({animation:!0,templateUrl:"views/voice-warning.html",controller:"VoiceWarningCtrl",size:"sm"});c.result.then(function(){d.setVoiceAcceptance(!0),f()},function(){console.log("Modal dismissed at: "+new Date)})}})}}}}]),angular.module("itapapersApp").filter("orderObjectBy",function(){return function(a,b,c,d){var e=[];return angular.forEach(a,function(a){e.push(a)}),e.sort(function(a,d){var e;return a[b]===d[b]?c?"-"===c.charAt(0)?(e=c.substring(1),a[e]>d[e]?1:-1):a[c]<d[c]?1:-1:0:"-"===b.charAt(0)?(e=c.substring(1),a[e]>d[e]?1:-1):a[b]<d[b]?1:-1}),d&&e.reverse(),e}}),angular.module("itapapersApp").constant("colours",{areas:["#5596e6","#ff7f0e","#2ca02c"],papers:["#5596e6","#00b299","#7c56a5","#f49c4e","#cc3f40","#94a3ab"]}),angular.module("itapapersApp").factory("debug",["$rootScope","localStorageService",function(a,b){var c=b.get("debug"),d=function(d){c=d,b.set("debug",d),a.$broadcast("debug")},e=function(){return c};return{set:d,getState:e}}]),angular.module("itapapersApp").controller("AddCommentCtrl",["$scope","$uibModalInstance","localStorageService","page","id",function(a,b,c,d,e){a.type=d,a.id=e,a.user=c.get("user"),a.submit=function(){c.set("user",a.user),b.close({comment:a.comment,user:a.user})}}]),angular.module("itapapersApp").controller("CommentsCtrl",["$scope","$stateParams","store","debug",function(a,b,c,d){a.comments=[],a.issues=[];var e="unknown";b.debug&&d.set(b.debug),c.getComments().then(function(b){for(var c=0;c<b.length;++c){var d=b[c].property_values,f=d["was raised by"]?d["was raised by"][0]:e,g=d.text?d.text[0]:e,h=d["applies to"]?d["applies to"][0]:e,i=d.url?d.url[0]:null;if(i){var j=i.charAt(0);"/"===j&&(i=i.substring(1))}a.comments.push({user:f,comment:g,id:h,url:i})}}),c.getIssues().then(function(b){for(var c=0;c<b.length;++c){var d=b[c].property_values,f=d["was raised by"]?d["was raised by"][0]:e,g=d.text?d.text[0]:e;a.issues.push({user:f,comment:g})}})}]),angular.module("itapapersApp").constant("documentTypes",{journal:"journal document",external:"external conference document",patent:"patent",internal:"internal conference document",technical:"technical report",other:"other document",invitedTalk:"invited talk",bookChapter:"book chapter",phdThesis:"phd thesis",poster:"poster",workshop:"workshop",softwareAsset:"software asset",demonstration:"demonstration",nameMap:{"journal document":"Journal","external conference document":"External Conference",patent:"Patent","internal conference document":"Internal Conference","technical report":"Technical Report","other document":"Other Document","invited talk":"Invited Talk","book chapter":"Book Chapter","phd thesis":"PHD Thesis",poster:"Poster",workshop:"Workshop","software asset":"Software Asset",demonstration:"Demonstration"}}),angular.module("itapapersApp").factory("utils",["documentTypes",function(a){var b=a.nameMap;return{getType:function(c){return c.indexOf(a.journal)>-1?b[a.journal]:c.indexOf(a.external)>-1?b[a.external]:c.indexOf(a.patent)>-1?b[a.patent]:c.indexOf(a.internal)>-1?b[a.internal]:c.indexOf(a.technical)>-1?b[a.technical]:b[a.other]},getClassName:function(a){return a.toLowerCase().replace(/\s/g,"-")},sortTypes:function(c){return c.sort(function(c,d){return c===b[a.journal]?-1:d===b[a.journal]?1:c===b[a.external]?-1:d===b[a.external]?1:c===b[a.patent]?-1:d===b[a.patent]?1:c===b[a.internal]?-1:d===b[a.internal]?1:c===b[a.technical]?-1:d===b[a.technical]?1:c===b[a.other]?-1:d===b[a.other]?1:void 0}),c}}}]),angular.module("itapapersApp").controller("CollaborationCtrl",["$scope","$stateParams","$q","$document","store","utils","documentTypes","csv","colours",function(a,b,c,d,e,f,g,h,i){a.authors=[],a.views=["chart","list"],a.currentView=a.views[0],a.journalInput=a.externalInput=a.patentInput=a.internalInput=a.technicalInput=a.otherInput=!0,a.tipOpen=!1;var j,k,l=g.nameMap,m={};a.typeCount={},a.typeCount[l[g.journal]]=0,a.typeCount[l[g.external]]=0,a.typeCount[l[g.patent]]=0,a.typeCount[l[g.internal]]=0,a.typeCount[l[g.technical]]=0,a.typeCount[l[g.other]]=0,a.width=window.innerWidth,a.height=window.innerHeight;var n=a.height-270,o=angular.element("#collaborations-papers-list");o.css("height",n+20+"px"),o=angular.element("#collaborations-papers-list .results-list"),o.css("max-height","calc(100% - 75px)"),a.showView=function(b){a.currentView=b},a.hideTips=function(){angular.element(".d3-tip").css("opacity",0),angular.element(".d3-tip").css("display","none"),a.tipOpen=!1},a.filterPapers=function(b){return"undefined"!=typeof b.type?a.journalInput&&b.type.indexOf(l[g.journal])>-1||a.externalInput&&b.type.indexOf(l[g.external])>-1||a.patentInput&&b.type.indexOf(l[g.patent])>-1||a.internalInput&&b.type.indexOf(l[g.internal])>-1||a.technicalInput&&b.type.indexOf(l[g.technical])>-1||a.otherInput&&b.type.indexOf(l[g.other])>-1:void 0};var p,q,r=[];for(p=0;p<b.author.length;++p)r.push(e.getAuthor(b.author[p]));c.all(r).then(function(c){var d=[];for(p=0;p<c.length;++p){var e=c[p],i=e.structured_response.main_instance._id,n=e.structured_response.main_instance.property_values,o=n["full name"]?n["full name"][0]:null;if(a.authors.push({id:i,name:o}),0===p)d=n.wrote;else{var r=[];for(q=0;q<d.length;++q){var u=d[q];n.wrote&&n.wrote.indexOf(u)<0&&r.push(q)}for(var v=r.length-1;v>=0;--v)d.splice(r[v],1)}}var w=c[0].structured_response.related_instances;a.papers=[];var x={},y=[];for(p=0;p<d.length;++p){var z=d[p],A=f.getType(w[z].direct_concept_names),B=w[z].property_values,C=B.title?B.title[0]:null,D=0;if(a.typeCount[A]++,!x[z]){var E=!1,F=0;if(B.variant)for(q=0;q<B.variant.length;++q){var G=B.variant[q];x[G]&&(F=x[G].citations>F?x[G].citations:F,E=G)}var H=B["citation count"]?B["citation count"][0]:null;if(H){var I=w[H].property_values;if(D=I["citation count"]?I["citation count"][0]:0,E)if(D>F){var J=x[E].types.slice();x[E]=null,x[z]={citations:D,index:p,title:C,noteworthy:B["noteworthy reason"]?B["noteworthy reason"][0]:null,types:[A].concat(J),venue:B.venue?B.venue[0]:B["old venue"]?B["old venue"][0]:"",authors:B["original authors string"]?B["original authors string"][0]:"",weight:B.weight?B.weight[0]:-1}}else x[E].types.push(A);else x[z]={citations:D,index:p,title:C,noteworthy:B["noteworthy reason"]?B["noteworthy reason"][0]:null,types:[A],venue:B.venue?B.venue[0]:B["old venue"]?B["old venue"][0]:"",authors:B["original authors string"]?B["original authors string"][0]:"",weight:B.weight?B.weight[0]:-1}}}var K=B["final date"]?B["final date"][0]:null;if(K){var L=w[K].property_values.month,M=w[K].property_values.year;L||(L="1");var N=new Date(M,L-1);(!j||j>N)&&(j=N),(!k||N>k)&&(k=N),m[N]||(m[N]={},m[N][l[g.journal]]=[],m[N][l[g.external]]=[],m[N][l[g.patent]]=[],m[N][l[g.internal]]=[],m[N][l[g.technical]]=[],m[N][l[g.other]]=[]),m[N][A].push({id:z,title:C,citations:parseInt(D,10)})}}for(p=0;p<d.length;++p){var O=d[p],P=x[O];if(P&&P.index===p){var Q={id:O,name:P.title,noteworthy:P.noteworthy,value:P.citations,type:f.sortTypes(P.types),venue:P.venue,authors:P.authors,"class":[],weight:P.weight};for(q=0;q<Q.type.length;++q)Q["class"].push(f.getClassName(Q.type[q])),y.push([Q.id,Q.name,Q.value,Q.type[q],Q.venue,Q.authors]);a.papers.push(Q)}}if(h.setData(y),h.setHeader(["paper id","paper name","citation count","paper type","venue","authors"]),h.setName(b.author[0]+"_"+b.author[1]+"_collaborations"),a.journalPapers=a.typeCount[l[g.journal]],a.externalPapers=a.typeCount[l[g.external]],a.patents=a.typeCount[l[g.patent]],a.internalPapers=a.typeCount[l[g.internal]],a.technicalReports=a.typeCount[l[g.technical]],a.otherDocuments=a.typeCount[l[g.other]],a.totalPublications=a.journalPapers+a.externalPapers+a.patents+a.internalPapers,j&&k){for(var R=j;R.getTime()!==k.getTime();){m[R]||(m[R]={},m[R][l[g.journal]]=[],m[R][l[g.external]]=[],m[R][l[g.patent]]=[],m[R][l[g.internal]]=[],m[R][l[g.technical]]=[],m[R][l[g.other]]=[]);var S=R.getMonth();if(parseInt(S,10)<11)R.setMonth(S+1);else{var T=R.getFullYear();R.setMonth(0),R.setFullYear(parseInt(T,10)+1)}}var U=[];for(var V in m)U.push({date:V,journal:m[V][l[g.journal]],external:m[V][l[g.external]],patent:m[V][l[g.patent]],internal:m[V][l[g.internal]],technical:m[V][l[g.technical]],other:m[V][l[g.other]]});t(U)}var W=[{label:l[g.journal],value:a.journalPapers},{label:l[g.external],value:a.externalPapers},{label:l[g.patent],value:a.patents},{label:l[g.internal],value:a.internalPapers},{label:l[g.technical],value:a.technicalReports},{label:l[g.other],value:a.otherDocuments}];s(W)});var s=function(b){var c=.25*(a.width-200),d=a.height-500;(a.width<1e3||300>d)&&(c=300,d=300);var e=Math.min(c,d)/2,f=c/6,g=18,h=5,j=d3.scale.ordinal().range(i.papers),k=d3.select("#pie-chart").append("svg").attr("width",c).attr("height",d).attr("class","pie-svg").append("g").attr("transform","translate("+c/2+","+d/2+")"),l=d3.svg.arc().innerRadius(e-f).outerRadius(e),m=d3.layout.pie().value(function(a){return a.value}).sort(null),n=(k.selectAll("path").data(m(b)).enter().append("path").attr("d",l).attr("fill",function(a){return j(a.data.label)}),[]),o=0,p=k.selectAll(".legend").data(j.domain()).enter().append("g").attr("class","legend").attr("display",function(a){for(var c=0;c<b.length;++c)if(b[c].label===a&&(n.push(b[c].value),!b[c].value))return"none"}).attr("transform",function(a,b){o=0===n[b]?o+1:o;var c=g+h,d=c*j.domain().length/2,e=-2.5*g,f=(b-o)*c-d;return"translate("+e+","+f+")"});p.append("rect").attr("width",g).attr("height",g).style("fill",j).style("stroke",j),p.append("text").attr("x",g+h).attr("y",g-h).attr("class","pie-legend-text").text(function(a){return a})},t=function(b){var c={top:20,right:20,bottom:50,left:40},e=.66*(a.width-150-c.left-c.right),f=a.height-370-c.top-c.bottom,g=d3.scale.ordinal().rangeRoundBands([0,e],.1),h=d3.scale.linear().rangeRound([f,0]),j=d3.scale.ordinal().range(i.papers),k=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],l=d3.svg.axis().scale(g).tickFormat(function(a,b){var c=new Date(a);return g.domain().length<12?k[c.getMonth()]+" "+c.getFullYear():0===c.getMonth()?c.getFullYear():void 0}).orient("bottom"),m=d3.svg.axis().scale(h).orient("left"),n=d3.tip().attr("class","d3-tip dark-tip").offset([-10,0]).html(function(a){for(var b="<ul class='org-tip-content results-list'>",c=0;c<a.papers.length;++c){var d=a.papers[c].id,e=a.papers[c].title;a.papers[c].citations;b+="<li><a class='list-name' href='paper/"+d+"'>"+e+"</a></li>"}return b+="</ul>"}),o=d3.select("#bar-chart").append("svg").attr("width",e+c.left+c.right).attr("height",f+c.top+c.bottom).attr("class","organisation-bar-chart").append("g").attr("transform","translate("+c.left+","+c.top+")");o.call(n),j.domain(d3.keys(b[0]).filter(function(a){return"date"!==a}));var p={journal:0,external:0,patent:0,internal:0,technical:0,other:0};b.forEach(function(a){var b=0;a.papers=j.domain().map(function(c){return{name:c,y0:b,y1:b+=+a[c].length,papers:a[c].sort(function(a,b){return b.citations-a.citations})}}),a.total=a.papers[a.papers.length-1].y1,p.journal+=a.journal.length,p.external+=a.external.length,p.patent+=a.patent.length,p.internal+=a.internal.length,p.technical+=a.technical.length,p.other+=a.other.length}),b.sort(function(a,b){var c=new Date(a.date),d=new Date(b.date);return c-d}),g.domain(b.map(function(a){return a.date})),h.domain([0,d3.max(b,function(a){return a.total})]),o.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(l).selectAll("text").attr("x",-11).attr("y",10).style("text-anchor","start"),o.append("g").attr("class","y axis").call(m).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("No. of papers");var q=o.selectAll(".bar").data(b).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+g(a.date)+",0)"});q.selectAll("rect").data(function(a){return a.papers}).enter().append("rect").attr("width",g.rangeBand()).attr("y",function(a){return h(a.y1)}).attr("height",function(a){return h(a.y0)-h(a.y1)}).style("fill",function(a){return j(a.name)}).on("click",function(b){a.tipOpen||(angular.element(".d3-tip").css("display","inline"),n.show(b),a.tipOpen=!a.tipOpen)}),d.mouseup(function(b){var c=angular.element("d3-tip");a.tipOpen&&!c.is(b.target)&&a.hideTips()}),d3.selectAll("g.x.axis g.tick line").attr("y2",function(a){var b=new Date(a);return 0===b.getMonth()?6:0});var r=0,s=o.selectAll(".legend").data(j.domain().slice()).enter().append("g").attr("class","legend").attr("display",function(a){return p[a]?void 0:"none"}).attr("transform",function(a,b){return r=0===p[a]?r+1:r,"translate(0,"+20*(b-r)+")"});s.append("rect").attr("x",e-18).attr("width",18).attr("height",18).style("fill",j),s.append("text").attr("x",e-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return"journal"===a?"Journal":"external"===a?"External Conference":"patent"===a?"Patent":"internal"===a?"Internal Conference":"technical"===a?"Technical Report":"other"===a?"Other Document":void 0})}}]),angular.module("itapapersApp").directive("topHeader",function(){return{templateUrl:"views/top-header.html",restrict:"E"}}),angular.module("itapapersApp").directive("edgeBundleChart",["$parse","$window","store","csv",function(a,b,c,d){return{restrict:"EA",template:"<div id='edge-bundle-chart'></div>",link:function(e,f,g){function h(a,b){if(null===a.org)return-1;if(null===b.org)return 1;var c=V[a.org].sector,d=V[b.org].sector;return d>c?-1:c>d?1:a.org<b.org?-1:a.org>b.org?1:a.name<b.name?-1:a.name>b.name?1:0}function i(a){var b=90*(a.startAngle+a.endAngle)/Math.PI;return b>90&&270>b?b-180:b}function j(a){var b=90*(a.startAngle+a.endAngle)/Math.PI;return b>90&&270>b?"52px":"-46px"}function k(a){var b=90*(a.startAngle+a.endAngle)/Math.PI;return b>90&&270>b?"59px":"-50px"}function l(){m().then(n).then(o).then(p).then(q).then(function(){y()})}function m(){return c.getOrganisationDetails().then(function(a){M=a})}function n(){return c.getPersonDetails().then(function(a){N=a})}function o(){return c.getPeopleOrgs().then(function(a){O=a})}function p(){return c.getPersonDocument().then(function(a){P=a})}function q(){return c.getDocumentDetails().then(function(a){Q=a})}function r(){N&&N.results&&N.results.forEach(function(a){var b=a[0],c=a[1],d=a[2],e=a[3];U[b]={name:b,fn:c,sn:d,cc:e,papers:[]}})}function s(){P&&P.results&&P.results.forEach(function(a){var b=a[0],c=a[1];U[b]&&(X[c]=X[c]||{key:c,authors:[]},X[c].authors.push(b),U[b].papers.push(c))})}function t(){M&&M.results&&M.results.forEach(function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4];V[b]={id:b,name:c,shortName:d,sector:e,country:f,authors:[]},Z[e]=Z[e]||{id:e,orgs:[]}})}function u(){O&&O.results&&O.results.forEach(function(a){var b=a[0],c=a[1];U[b]&&(U[b].org=c)})}function v(){O&&O.results&&O.results.forEach(function(a){var b=a[0],c=a[1];U[b]&&V[c].authors.push(b)})}function w(){Q&&Q.results&&Q.results.forEach(function(a){var b=a[0],c=a[1],d=a[2],e=a[3];X[b]&&(c&&(X[b].title=c),X[b].month=d,X[b].year=e)})}function x(){for(var a in V){var b=V[a].sector;Z[b].orgs.push(a)}}function y(){U={},V={},W=[],X={},Y={},Z={},$=[],ma=T.layout.pie().sort(null).value(function(a){return a.authorCount}),r(),s(),t(),u();var a,b,c=function(a,b){return b.cc-a.cc},d={},f=[];for(a in U){var g=V[U[a].org].sector;("AC"===g&&J||"GOV"===g&&L||"IND"===g&&K)&&f.push({id:a,cc:U[a].cc})}for(f=f.sort(c).slice(0,e.listLength),b=0;b<f.length;++b){var h=f[b];d[h.id]=angular.copy(U[h.id])}for(a in X){var i=X[a],j=[];for(b=0;b<i.authors.length;++b){for(var k=i.authors[b],l=!1,m=0;m<f.length;++m)f[m].id===k&&(l=!0);l||j.push(b)}for(b=j.length-1;b>=0;--b)i.authors=i.authors.splice(b,1);0===i.authors.length&&delete X[a]}U=d,v(),w(),x(),z()}function z(){var a=0,b=null;W=Object.keys(V).map(function(a){return V[a]}).sort(function(a,b){var c=V[a.id].sector,d=V[b.id].sector;return d>c?-1:c>d?1:a.id<b.id?-1:1}).map(function(c){return c.sector!==b&&(a=0,b=c.sector),c.orgIndex=a++,c}),$=Object.keys(Z).map(function(a){var b=Z[a];return b.authorCount=0,b.orgs.forEach(function(a){b.authorCount+=V[a].authors.length}),Z[a]}).sort(function(a,b){return a.id<b.id?-1:a.id>b.id?1:0}),Object.keys(X).forEach(function(a){for(var b=X[a],c=b.authors,d=0;d<c.length-1;d++)for(var e=c[d],f=d+1;f<c.length;f++){var g=c[f];if(e>g){var h=g;g=e,e=h}Y[e]=Y[e]||{},Y[e][g]=(Y[e][g]||0)+1}});var c={name:"",children:[],depth:0},e=[];a=0,c.children=Object.keys(U).map(function(b){var d=U[b];return d.id=a++,d.parent=c,d.depth=1,d.key=b,e.push([d.key,d.fn,d.sn,d.org,d.cc]),U[b]});var f=[];Object.keys(Y).forEach(function(a){var b=Y[a];Object.keys(b).forEach(function(c){f.push({source:U[a],target:U[c],value:b[c]})})}),d.setData(e),d.setHeader(["id","first name","surname","organisation","coauthor count"]),d.setName("co-authors"),B(c,f)}function A(a,b,c){if(Z[a]){var d=Z[a].orgs.length,e=T.scale.linear().domain([0,d]).interpolate(T.interpolateRgb).range([T.rgb(pa(a)).brighter(1),c]);return function(a){return e(a%2===0?Math.floor(a/2):Math.floor(d/2+a/2))}}}function B(a,b){function c(a){var b=T.interpolate(this._current,a);return this._current=b(0),function(a){return ka(b(a))}}function d(a){return a.data&&a.data.id?a.data.id:void 0}function e(a){var b=T.interpolate(this._current,a);return this._current=b(0),function(a){return ja(b(a))}}function f(a){return a.data.id}a=ca.nodes(a);var g=da(b),h={AC:A("AC",0,"#8CA69E"),GOV:A("GOV",1,"#D0CC98"),IND:A("IND",2,"#D0BA98")},l=ha.selectAll("path.link").data(b);l.enter().append("svg:path").attr("class",function(a){return"link link-author-"+a.source.key+" link-author-"+a.target.key+" link-org-"+a.source.org+" link-org-"+a.target.org}).attr("stroke-width",function(a){return Math.max(1,Math.sqrt(a.value))}).attr("d",function(){var a=Math.random(),b=g.length*Math.floor(a);return ea(g[b])}),l.transition().duration(500).attr("d",function(a,b){return ea(g[b])}).attr("class",function(a){return"link link-author-"+a.source.key+" link-author-"+a.target.key+" link-org-"+a.source.org+" link-org-"+a.target.org}).attr("stroke-width",function(a){return Math.max(1,Math.sqrt(a.value))}),l.exit().transition().duration(500).attr("d",function(){if(g&&g.length>0){var a=Math.random(),b=g.length*Math.floor(a);return ea(g[b])}}).remove();var m=ha.selectAll("g.secarc").data(ma($),d),n=m.enter().append("g").attr("class","secarc");n.append("path").attr("d",ka).style("stroke-width","2").style("fill",function(a){return pa(a.data.id)}).each(function(a){this._current=a}),n.append("text").attr("transform",function(a){return"translate("+ka.centroid(a)+") rotate("+i(a)+")"}).attr("dy",k).style("text-anchor","middle").style("font-size","12px").style("fill","#fff").text(function(a){
return oa[a.data.id]}),m.select("path").transition().duration(750).attrTween("d",c),m.select("text").transition().duration(750).attr("transform",function(a){return"translate("+ka.centroid(a)+") rotate("+i(a)+")"}).attr("dy",k).text(function(a){return a.value>0?oa[a.data.id]:void 0}),m.exit().remove();var o=ha.selectAll("g.orgarc").data(la(W),f);n=o.enter().append("g").attr("class","orgarc"),n.append("path").attr("d",ja).style("stroke-width",1).style("fill",function(a){var b=h[a.data.sector](a.data.orgIndex);return b}).each(function(a){this._current=a}).on("mouseover",function(a){C("org",a.data.id,a.data.id)}).on("mouseout",function(a){D("org",a.data.id,a.data.id)}).on("click",function(a){var b="organisation/"+a.data.id;window.location.href=b}),n.append("text").attr("transform",function(a){return"translate("+ja.centroid(a)+") rotate("+i(a)+")"}).attr("dy",j).style("text-anchor","middle").style("font-size","10px").style("fill","#fff").style("pointer-events","none").text(function(a){return Math.abs(a.endAngle-a.startAngle)>.01?a.data.shortName:void 0}),o.select("path").transition().duration(750).attrTween("d",e),o.select("text").transition().duration(750).attr("transform",function(a){return"translate("+ja.centroid(a)+") rotate("+i(a)+")"}).attr("dy",j).text(function(a){return Math.abs(a.endAngle-a.startAngle)>.01?a.data.shortName:void 0}),o.exit().remove();var p=ha.selectAll("g.node").data(a.filter(function(a){return!a.children}),function(a){return a.key});n=p.enter().append("g").attr("class","node").attr("id",function(a){return"node-"+a.key}).attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+a.y+")"}),n.append("text").attr("class",function(a){return a?"author author-author-"+a.key+" author-org-"+a.org:void 0}).attr("dx",function(a){return a.x<180?8:-8}).attr("dy",".31em").attr("text-anchor",function(a){return a.x<180?"start":"end"}).attr("transform",function(a){return a.x<180?null:"rotate(180)"}).text(function(a){if(a&&a.fn){var b=a.fn+" "+a.sn;return b.length>15&&(b=a.fn[0]+". "+a.sn),b.length>15&&(b=b.substring(0,15)+"..."),b}}).on("mouseover",function(a){C("author",a.key)}).on("mouseout",function(a){D("author",a.key)}).on("click",function(a){var b="author/"+a.key;window.location.href=b}),p.transition().duration(750).attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+a.y+")"}),p.select("text").transition().duration(750).attr("dx",function(a){return a.x<180?8:-8}).attr("dy",".31em").attr("text-anchor",function(a){return a.x<180?"start":"end"}).attr("transform",function(a){return a.x<180?null:"rotate(180)"}).text(function(a){if(a&&a.fn){var b=a.fn+" "+a.sn;return b.length>15&&(b=a.fn[0]+". "+a.sn),b.length>15&&(b=b.substring(0,15)+"..."),b}}),p.exit().remove()}function C(a,b,c){ha.selectAll("path.link.link-"+a+"-"+b).classed("link-active",!0).each(function(a){ha.select("#node-"+a.source.key).classed("author-active",!0),ha.select("#node-"+a.target.key).classed("author-active",!0)}),c&&ha.selectAll(".author-org-"+c).classed("author-org-active",!0)}function D(a,b){ha.selectAll("path.link.link-"+a+"-"+b).classed("link-active",!1).each(function(a){ha.select("#node-"+a.source.key).classed("author-active",!1).classed("author-org-active",!1),ha.select("#node-"+a.target.key).classed("author-active",!1).classed("author-org-active",!1)}),ha.selectAll(".author-org-active").classed("author-org-active",!1)}var E=a(g.numAuthors),F=a(g.ac),G=a(g.ind),H=a(g.gov),I=E(e),J=F(e),K=G(e),L=H(e);e.$watchCollection(E,function(a){I=a,y()}),e.$watchCollection(F,function(a){J=a,y()}),e.$watchCollection(G,function(a){K=a,y()}),e.$watchCollection(H,function(a){L=a,y()});var M,N,O,P,Q,R,S,T=b.d3,U={},V={},W=[],X={},Y={},Z={},$=[];R=S=e.width>e.height?e.height-270:e.width-50;var _=R/2,aa=S/2,ba=Math.min(R,S)/2,ca=T.layout.cluster().size([360,aa-130]).sort(h),da=T.layout.bundle(),ea=T.svg.line.radial().interpolate("bundle").tension(.95).radius(function(a){return a.y}).angle(function(a){return a.x/180*Math.PI}),fa=T.select("#edge-bundle-chart").insert("div","h2").style("width",R+"px").style("height",R+"px").style("margin","auto").style("-webkit-backface-visibility","hidden"),ga=fa.append("svg:svg").attr("width",R).attr("height",R),ha=ga.append("svg:g").attr("transform","translate("+_+","+aa+")"),ia=ga.append("svg:g").attr("transform","translate("+_+","+aa+")").style("display","none");ia.append("svg:rect").attr("x",-R/2).attr("y",-S/2).attr("width",R).attr("height",S).attr("opacity",.9).attr("stroke","#f00"),ia.append("svg:g").attr("transform","translate("+-_+","+-aa+")");var ja=T.svg.arc().outerRadius(ba-20).innerRadius(ba-130),ka=T.svg.arc().outerRadius(ba).innerRadius(ba-130),la=T.layout.pie().sort(null).value(function(a){return a.authors.length}),ma=T.layout.pie().sort(null).value(function(a){return a.authorCount}),na=["#5596e6","#2ca02c","#ff7f0e"],oa={AC:"Academia",GOV:"Government",IND:"Industry"},pa=T.scale.ordinal().domain(Object.keys(oa)).range(na);l()}}}]),angular.module("itapapersApp").directive("forceDirectedGraph",["$parse","$window",function(a,b){return{template:"<div id='force-directed-graph'></div>",restrict:"E",link:function(c,d,e){var f=a(e.nodes),g=f(c),h=[],i=[],j={};c.$watchCollection(f,function(a){g=a,F()});var k=a(e.ac),l=a(e.ind),m=a(e.gov),n=k(c),o=l(c),p=m(c);c.$watchCollection(k,function(a){n=a,F()}),c.$watchCollection(l,function(a){o=a,F()}),c.$watchCollection(m,function(a){p=a,F()});var q=b.d3,r=.75*c.width-100,s=c.height-320,t=0,u=!0,v=q.scale.ordinal().domain(["AC","IND","GOV"]).range(["#5596e6","#ff7f0e","#2ca02c"]),w=function(){E.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),D.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})},x=q.layout.force().linkStrength(function(a){return a.value/t}).size([r,s]).on("tick",w),y=q.tip().attr("class","d3-tip dark-tip small-tip").offset([-10,0]).html(function(a){var b=q.selectAll(".link-"+a.id)[0].length,c="<span>Name: </span><span class='highlight'>"+a.name+"</span><br>";return a.id!==g[0].id&&(c+="<span>Papers with "+g[0].name+": </span><span class='highlight'>"+a.count+"</span><br>"),c+="<span>Visible co-authors: </span><span class='highlight'>"+b+"</span>"}),z=function(){u=q.select("#interlinks").property("checked"),F()};q.select("#force-directed-graph").append("label").attr("class","interlinks-label").attr("for","interlinks").text("Show interlinks").append("input").attr("checked",!0).attr("type","checkbox").attr("id","interlinks").on("click",z);var A=q.select("#force-directed-graph").append("svg").attr("width",r).attr("height",s),B=A.append("g").attr("class","link-group"),C=A.append("g").attr("class","node-group");A.call(y);var D=C.selectAll(".node"),E=B.selectAll(".link"),F=function(){if(g){h=[],i=[],j={},t=0;var a=0,b=!1,c={},d=g[0].id;g.forEach(function(e,f){if(("AC"===e.group&&n||"GOV"===e.group&&p||"IND"===e.group&&o)&&(0===f&&(b=!0,j[d]=j[d]?j[d]:[]),b)){var g=e.id;c[g]=a,h.push(angular.copy(e)),0!==f&&(i.push({id:g,source:0,target:a,value:e.count}),j[d].push(g),j[g]=j[g]?j[g]:[],j[g].push(d),e.count>t&&(t=e.count)),a++}}),u&&h.forEach(function(a){if(a.links)for(var b in a.links){var d=a.links[b],e=d.authors[0]===a.id?d.authors[1]:d.authors[0],f=c[e];f&&j[e]&&j[e].indexOf(a.id)<0&&(i.push({id:d.id,source:c[a.id],target:f,value:d.count}),j[e]=j[e]?j[e]:[],j[e].push(a.id),j[a.id]=j[a.id]?j[a.id]:[],j[a.id].push(e),d.count>t&&(t=d.count))}});var e=Math.sqrt(h.length/(r*s));x.nodes(h).links(i).charge(-20/e).gravity(100*e).start(),K()}},G=function(a){var b=a.split(" "),c="";for(var d in b)c+=b[d].charAt(0);return c.toUpperCase()},H=function(a){return Math.max(Math.sqrt(a.value)/Math.sqrt(t),.1)},I=function(a){y.show(a),q.selectAll(".link-"+a.id).style("opacity",1),q.select(".node-"+a.id+" circle").style("stroke-width",2).style("stroke","#fff");for(var b in j[a.id]){var c=j[a.id][b];q.select(".node-"+c+" circle").style("stroke-width",2).style("stroke","#fff")}},J=function(a){y.hide(a),q.selectAll(".link-"+a.id).style("opacity",H),q.select(".node-"+a.id+" circle").style("stroke-width",0);for(var b in j[a.id]){var c=j[a.id][b];q.select(".node-"+c+" circle").style("stroke-width",0)}},K=function(){E=E.data(x.links(),function(a){return a.id});var a=E.enter().append("line").attr("class",function(a){return"link link-"+a.source.id+" link-"+a.target.id});a.style("stroke-width",function(a){return Math.sqrt(a.value)}).style("opacity",H),E.exit().remove(),D=D.data(x.nodes(),function(a){return a.id});var b=D.enter().append("g").attr("class",function(a){return"node node-"+a.id});b.filter(function(a,b){return 0===b}).append("circle").attr("r",25).style("fill",function(a){return v(a.group)}).call(x.drag).on("mousemove",I).on("mouseout",J),b.filter(function(a,b){return 0!==b}).append("circle").attr("r",14).style("fill",function(a){return v(a.group)}).call(x.drag).on("mousemove",I).on("mouseout",J).on("click",function(a){var b="collaboration?author="+h[0].id+"&author="+a.id;window.location.href=b}),b.append("text").attr("dy",".35em").text(function(a){return G(a.name)}),D.exit().remove()}}}}]),angular.module("itapapersApp").factory("csv",function(){var a=[],b="",c="test.csv";return{setData:function(b){a=b},getData:function(){return a},setHeader:function(a){b=a},getHeader:function(){return b},setName:function(a){c=a+".csv"},getName:function(){return c}}}),angular.module("itapapersApp").controller("VoiceWarningCtrl",["$scope","$uibModalInstance",function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss()}}]),angular.module("itapapersApp").controller("StatisticsCtrl",["$scope","store",function(a,b){b.getStatistics().then(function(a){c(a)});var c=function(b){a.statistics=[];for(var c in b.instances){var d=b.instances[c].property_values,e={scope:parseInt(d.scope[0],10)?parseInt(d.scope[0],10):d.scope[0],totalPubs:parseInt(d["total paper count"][0],10),singleInstCount:parseInt(d["single institute paper count"][0],10),collabCount:parseInt(d["collaborative paper count"][0],10),internationalCount:parseInt(d["international paper count"][0],10),govCount:parseInt(d["government paper count"][0],10),journalCount:parseInt(d["journal paper count"][0],10),extCount:parseInt(d["external conference paper count"][0],10),patentCount:parseInt(d["patent count"][0],10),activeITA:parseInt(d["active ITA authors"][0],10),activeNonITA:parseInt(d["active non-ITA authors"][0],10),citations:parseInt(d["total citations"][0],10)};e.totalAuthors=e.activeITA+e.activeNonITA,e.singleInstCountPercent=Math.round(e.singleInstCount/e.totalPubs*100),e.collabCountPercent=Math.round(e.collabCount/e.totalPubs*100),e.internationalCountPercent=Math.round(e.internationalCount/e.totalPubs*100),e.govCountPercent=Math.round(e.govCount/e.totalPubs*100),e.journalCountPercent=Math.round(e.journalCount/e.totalPubs*100),e.extCountPercent=Math.round(e.extCount/e.totalPubs*100),e.patentCountPercent=Math.round(e.patentCount/e.totalPubs*100),e.activeITAPercent=Math.round(e.activeITA/e.totalAuthors*100),e.activeNonITAPercent=Math.round(e.activeNonITA/e.totalAuthors*100),a.statistics.push(e)}}}]),angular.module("itapapersApp").run(["$templateCache",function(a){a.put("views/add-comment.html",'<div class="modal-header"> <h2>Add a comment for {{type}} {{id}}</h2> </div> <div class="modal-body"> <div> <label> User: <input ng-model="user" ng-placeholder="Your name"> </label> </div> <div> <textarea class="comment-textarea" ng-model="comment" placeholder="Write comment..."></textarea> </div> </div> <div class="modal-footer"> <button class="btn-primary" type="button" ng-click="submit()">Submit</button> </div>'),a.put("views/author.html",'<div class="col-md-12 footer-padding"> <div class="row"> <!-- Title --> <p class="center"><span class="highlight" ng-class="[{\'answer-highlight\': full_nameHighlight}]">{{author}}</span> is affiliated to <span class="highlight"><a ng-href="organisation/{{employer.id}}" ng-class="[{\'answer-highlight\': is_employed_byHighlight}]">{{employer.name}}</a></span></p> </div> <!-- Chart --> <div class="row"> <div class="col-md-9"> <div ng-show="currentView === views[0]" id="narrative-chart" class="panel"></div> <div ng-show="currentView === views[1]" id="authors-publications-list" class="list-view list-view-no-margin" ng-class="[{\'answer-highlight\': wroteHighlight}]"> <h3 class="floating-header">{{author}} wrote</h3> <div class="authorFilters"> <label ng-show="journalPapers" class="journal"></label> <input ng-show="journalPapers" id="journalInput" type="checkbox" ng-model="journalInput"> <label ng-show="externalPapers" class="external-conference"></label> <input ng-show="externalPapers" id="externalInput" type="checkbox" ng-model="externalInput"> <label ng-show="patents" class="patent"></label> <input ng-show="patents" id="patentInput" type="checkbox" ng-model="patentInput"> <label ng-show="internalPapers" class="internal-conference"></label> <input ng-show="internalPapers" id="internalInput" type="checkbox" ng-model="internalInput"> <label ng-show="technicalReports" class="technical-report"></label> <input ng-show="technicalReports" id="technicalInput" type="checkbox" ng-model="technicalInput"> <label ng-show="otherDocuments" class="other-document"></label> <input ng-show="otherDocuments" id="otherInput" type="checkbox" ng-model="otherInput"> </div> <ul class="results-list clear" id="publications-results-list"> <li class="no-bullets" ng-repeat="paper in papersList | orderBy : \'name\' | orderBy : \'-weight\' | filter : filterPapers"> <span ng-class="[className, (\'document-\' + $index)]" ng-repeat="className in paper.class track by $index"></span> <a ng-href="paper/{{paper.id}}" class="list-name">{{paper.name}}</a> <small ng-if="paper.noteworthy"><span class="glyphicon glyphicon-star-empty highlight" aria-hidden="true"></span> ({{paper.noteworthy}})</small><!-- <small ng-if="paper.citations" class="highlight" uib-tooltip="Citation count">({{paper.citations}})</small> --> </li> </ul> </div> <div ng-show="currentView === views[2]" id="authors-coauthors-list" class="list-view list-view-no-margin" ng-class="[{\'answer-highlight\': co-authorHighlight}]"> <h3>{{author}} co-authored with</h3> <ul class="results-list" id="coauthors-results-list"> <li ng-repeat="coauthor in coauthorsList | orderBy : \'-count\'"> <a ng-href="collaboration?author={{authorId}}&author={{coauthor.id}}" class="list-name">{{coauthor.name}}</a> <!-- <small class="highlight" uib-tooltip="Number of co-authored papers">({{coauthor.count}})</small> --> </li> </ul> </div> <div ng-show="currentView === views[3]" id="authors-coauthors-chart" class="list-view list-view-no-margin" ng-class="[{\'answer-highlight\': co-authorHighlight}]"> <div> <h3 class="floating-header">{{author}} co-authors with</h3> <div class="authorFilters filters-right"> <label class="ac"></label> <input id="acInput" type="checkbox" ng-model="acInput"> <label class="ind"></label> <input id="indInput" type="checkbox" ng-model="indInput"> <label class="gov"></label> <input id="govInput" type="checkbox" ng-model="govInput"> </div> </div> <force-directed-graph nodes="nodes" ac="acInput" gov="govInput" ind="indInput"></force-directed-graph> <p class="helper-text center">Hover over a node to view co-author\'s details. Click a node to go to their collaboration page.</p> </div> <div class="center"> <button ng-show="currentView !== views[0]" class="btn view-btn" ng-click="showView(views[0])">Show Narrative Chart</button> <button ng-show="currentView !== views[1]" class="btn view-btn" ng-click="showView(views[1])">List Papers</button> <button ng-show="currentView !== views[2]" class="btn view-btn" ng-click="showView(views[2])">List Co-Authors</button> <button ng-show="currentView !== views[3]" class="btn view-btn" ng-click="showView(views[3])">Show Co-Authors Graph</button> </div> </div> <!-- <div class="row author-pubs"> --> <div class="col-md-3"> <!-- Publications --> <div> <h3>Statistics</h3> <div class="total-publication-count"> <dl class="dl-horizontal dl-publications" ng-class="[{\'answer-highlight\': publicationsHighlight}]"> <div ng-show="totalPublications" ng-class="[{\'answer-highlight\': total_publication_countHighlight}]"> <dt>Total ITA Publications</dt> <dd>{{totalPublications}}</dd> </div> </dl> <dl class="dl-horizontal dl-publications" ng-class="[{\'answer-highlight\': publicationsHighlight}]"> <div ng-show="journalPapers" ng-class="[{\'answer-highlight\': journal_paper_countHighlight}]"> <dt>Journals</dt> <dd>{{journalPapers}}</dd> </div> <div ng-show="externalPapers" ng-class="[{\'answer-highlight\': external_paper_countHighlight}]"> <dt>External Conferences</dt> <dd>{{externalPapers}}</dd> </div> <div ng-show="patents" ng-class="[{\'answer-highlight\': patent_countHighlight}]"> <dt>Patents</dt> <dd>{{patents}}</dd> </div> <div ng-show="internalPapers" ng-class="[{\'answer-highlight\': internal_paper_countHighlight}]"> <dt>Internal Conferences</dt> <dd>{{internalPapers}}</dd> </div> <div ng-show="technicalReports" ng-class="[{\'answer-highlight\': technical_report_countHighlight}]"> <dt>Technical Reports</dt> <dd>{{technicalReports}}</dd> </div> <div ng-show="otherDocuments" ng-class="[{\'answer-highlight\': other_document_countHighlight}]"> <dt>Other Documents</dt> <dd>{{otherDocuments}}</dd> </div> </dl> </div> </div> <!-- Citations --> <div> <dl class="dl-horizontal dl-publications"> <div ng-class="[{\'answer-highlight\': citation_countHighlight}]"> <dt>Citation Count</dt> <dd ng-if="citationCount"> <a ng-if="citationCount.url" ng-href="{{citationCount.url}}">{{citationCount.count}}</a> <span ng-if="!citationCount.url">{{citationCount.count}}</span> </dd> <dd ng-if="!citationCount"> <a ng-href="{{scholarLink}}">Unknown</a> <button class="btn" ng-click="addCitations()">Add Citation Count</button> </dd> </div> <div class="dl-horizontal dl-publications" ng-class="[{\'answer-highlight\': h_indexHighlight}]"> <dt>H-Index</dt> <dd ng-if="hIndex"> <a ng-if="hIndex.url" ng-href="{{hIndex.url}}">{{hIndex.index}}</a> <span ng-if="!hIndex.url">{{hIndex.index}}</span> </dd> <dd ng-if="!hIndex"> <a ng-href="{{scholarLink}}">Unknown</a> <button class="btn" ng-click="addCitations()">Add H-Index</button> </dd> </div> </dl> </div> <!-- Pie Chart --> <div id="pie-chart"></div> </div> <!-- </div> --> </div> </div>'),a.put("views/collaboration.html",'<div class="col-md-12 footer-padding"> <div class="row"> <!-- Description --> <p class="center"> Collaborations between <span ng-class="[{\'answer-highlight\': nameHighlight}]" ng-repeat="author in authors"> <a ng-href="author/{{author.id}}">{{author.name}}</a><span ng-if="$index < authors.length - 2">,</span><span ng-if="$index === authors.length - 2"> and</span><span ng-if="$index === authors.length - 1">.</span> </span> </p> </div> <div class="row"> <div class="list-view"> <div class="col-md-9"> <div ng-show="currentView === views[0]"> <h3>Papers</h3> <div id="bar-chart"></div> </div> <div ng-show="currentView === views[1]" id="collaborations-papers-list"> <h3 class="floating-header">Papers</h3> <div class="authorFilters"> <label ng-show="journalPapers" class="journal"></label> <input ng-show="journalPapers" id="journalInput" type="checkbox" ng-model="journalInput"> <label ng-show="externalPapers" class="external-conference"></label> <input ng-show="externalPapers" id="externalInput" type="checkbox" ng-model="externalInput"> <label ng-show="internalPapers" class="internal-conference"></label> <input ng-show="internalPapers" id="internalInput" type="checkbox" ng-model="internalInput"> <label ng-show="technicalReports" class="technical-report"></label> <input ng-show="technicalReports" id="technicalInput" type="checkbox" ng-model="technicalInput"> <label ng-show="otherDocuments" class="other-document"></label> <input ng-show="otherDocuments" id="otherInput" type="checkbox" ng-model="otherInput"> </div> <ul class="results-list clear" id="publications-results-list"> <li class="no-bullets" ng-repeat="item in papers | limitTo : listLength | orderBy : \'name\' | orderBy : \'-weight\' | filter : filterPapers"> <span ng-class="[className, (\'document-\' + $index)]" ng-repeat="className in item.class track by $index"></span> <a ng-href="paper/{{item.id}}" class="list-name">{{item.name}}</a> <small ng-if="item.noteworthy"><span class="glyphicon glyphicon-star-empty highlight" aria-hidden="true"></span> ({{item.noteworthy}})</small> <!-- <small class="highlight" uib-tooltip="Citation count">({{item.value}})</small> --> </li> </ul> </div> <button ng-show="currentView !== views[0]" class="btn view-btn" ng-click="showView(views[0])">Show Papers Chart</button> <button ng-show="currentView !== views[1]" class="btn view-btn" ng-click="showView(views[1])">List Papers</button> <div ng-show="currentView !== views[1]" class="float-right"> <span class="helper-text">Click a bar on the graph to show papers.</span> </div> </div> <div class="col-md-3"> <h3>Statistics</h3> <div class="total-publication-count"> <dl class="dl-horizontal dl-publications" ng-class="[{\'answer-highlight\': publicationsHighlight}]"> <div ng-show="totalPublications" ng-class="[{\'answer-highlight\': total_publication_countHighlight}]"> <dt>Total ITA Publications</dt> <dd>{{totalPublications}}</dd> </div> </dl> <dl class="dl-horizontal dl-publications" ng-class="[{\'answer-highlight\': publicationsHighlight}]"> <div ng-show="journalPapers" ng-class="[{\'answer-highlight\': journal_paper_countHighlight}]"> <dt>Journals</dt> <dd>{{journalPapers}}</dd> </div> <div ng-show="externalPapers" ng-class="[{\'answer-highlight\': external_paper_countHighlight}]"> <dt>External Conferences</dt> <dd>{{externalPapers}}</dd> </div> <div ng-show="internalPapers" ng-class="[{\'answer-highlight\': internal_paper_countHighlight}]"> <dt>Internal Conferences</dt> <dd>{{internalPapers}}</dd> </div> <div ng-show="technicalReports" ng-class="[{\'answer-highlight\': technical_report_countHighlight}]"> <dt>Technical Reports</dt> <dd>{{technicalReports}}</dd> </div> <div ng-show="otherDocuments" ng-class="[{\'answer-highlight\': other_document_countHighlight}]"> <dt>Other Documents</dt> <dd>{{otherDocuments}}</dd> </div> </dl> </div> <!-- Pie Chart --> <div class="small-pie" id="pie-chart"></div> </div> </div> </div> </div>'),a.put("views/comments.html",'<div class="col-md-12 footer-padding"> <div class="row"> <div class="list-view"> <h3>Comments</h3> <div> <!-- Results list --> <ul class="results-list"> <li ng-repeat="item in comments"> <a ng-if="item.url" ng-href="{{item.url}}"> <span ng-if="item.id">{{item.id}} - </span> {{item.comment}} - {{item.user}} </a> <span ng-if="!item.url"> <span ng-if="item.id">{{item.id}} - </span> {{item.comment}} - {{item.user}} </span> </li> </ul> </div> </div> <div class="list-view"> <h3>Issues</h3> <div> <!-- Results list --> <ul class="results-list"> <li ng-repeat="item in issues"> <a ng-if="item.url" ng-href="{{item.url}}"> <span ng-if="item.id">{{item.id}} - </span> {{item.comment}} - {{item.user}} </a> <span ng-if="!item.url"> <span ng-if="item.id">{{item.id}} - </span> {{item.comment}} - {{item.user}} </span> </li> </ul> </div> </div> </div> </div>'),a.put("views/ita-footer.html",'<footer class="footer"> <form ng-submit="submit()"> <h4 ng-click="resetListener()" class="reset-listener">H</h4> <input id="question-box" type="text" ng-model="question" name="text" class="question-text" placeholder="Some commands to try... \'Show me IBM UK\', \'What is Fusion 2012?\'"> <input type="submit" id="submit" value="GO" class="question-submit"> </form> </footer>'),a.put("views/ita-header.html",'<div class="page-header"> <a ng-href="." ng-click="refresh()"><h1>Science Library</h1></a> <button ng-click="reset()" class="btn reset-btn">Reset</button> <button ng-csv="getCSVData" csv-header="getCSVHeader()" filename="{{ csvFileName() }}" tooltip-placement="bottom" uib-tooltip="{{ tooltipHTML() }}" class="btn reset-btn">Export</button> <a ng-href="statistics"><button class="btn reset-btn">Statistics</button></a> <a ng-if="debug" ng-href="comments"><button class="btn reset-btn">Comments</button></a> <button ng-if="debug" ng-click="addComment()" class="btn reset-btn">Add Comment</button> </div>'),a.put("views/main.html",'<div class="col-md-12 footer-padding"> <div class="row"> <!-- Description --> <p class="center details">A tool to navigate around publications. {{ lastUpdated }} <small class="highlight" ng-click="reset()"><a href="">(Refresh)</a></small>.</p> </div> <div class="row"> <div class="list-view"> <div ng-show="listName === listTypes[0]"> <div class="col-md-8"> <top-header></top-header> <div class="authorFilters"> <label ng-show="journalPapers" class="journal"></label> <input ng-show="journalPapers" id="journalInput" type="checkbox" ng-model="journalInput"> <label ng-show="externalPapers" class="external-conference"></label> <input ng-show="externalPapers" id="externalInput" type="checkbox" ng-model="externalInput"> <label ng-show="patents" class="patent"></label> <input ng-show="patents" id="patentInput" type="checkbox" ng-model="patentInput"> <label ng-show="internalPapers" class="internal-conference"></label> <input ng-show="internalPapers" id="internalInput" type="checkbox" ng-model="internalInput"> <label ng-show="technicalReports" class="technical-report"></label> <input ng-show="technicalReports" id="technicalInput" type="checkbox" ng-model="technicalInput"> <label ng-show="otherDocuments" class="other-document"></label> <input ng-show="otherDocuments" id="otherInput" type="checkbox" ng-model="otherInput"> </div> <!-- Papers list --> <div class="clear"> <div class="col-md-12"> <ul class="results-list no-bullets"> <li ng-repeat="item in list | orderBy : \'name\' | orderBy : \'-weight\' | filter : filterPapers | limitTo : listLength"> <span ng-class="[className, (\'document-\' + $index)]" ng-repeat="className in item.class track by $index"></span> <a ng-href="{{listName | limitTo : listName.length - 1}}/{{item.id}}" class="list-name">{{item.name}}</a> <small ng-if="item.noteworthy"><span class="glyphicon glyphicon-star-empty highlight" aria-hidden="true"></span> ({{item.noteworthy}})</small> <!-- <small ng-if="item.value" class="highlight" uib-tooltip="Citation count">({{item.value}})</small> --> </li> </ul> </div> </div> </div> <div class="col-md-4"> <!-- Publications --> <h3>Statistics</h3> <div class="total-publication-count"> <dl class="dl-horizontal dl-publications" ng-class="[{\'answer-highlight\': publicationsHighlight}]"> <div ng-show="totalPublications" ng-class="[{\'answer-highlight\': total_publication_countHighlight}]"> <dt>Total ITA Publications</dt> <dd>{{totalPublications}}</dd> </div> </dl> <dl class="dl-horizontal dl-publications" ng-class="[{\'answer-highlight\': publicationsHighlight}]"> <div ng-show="journalPapers" ng-class="[{\'answer-highlight\': journal_paper_countHighlight}]"> <dt>Journals</dt> <dd>{{journalPapers}}</dd> </div> <div ng-show="externalPapers" ng-class="[{\'answer-highlight\': external_paper_countHighlight}]"> <dt>External Conferences</dt> <dd>{{externalPapers}}</dd> </div> <div ng-show="patents" ng-class="[{\'answer-highlight\': patent_countHighlight}]"> <dt>Patents</dt> <dd>{{patents}}</dd> </div> <div ng-show="internalPapers" ng-class="[{\'answer-highlight\': internal_paper_countHighlight}]"> <dt>Internal Conferences</dt> <dd>{{internalPapers}}</dd> </div> <div ng-show="technicalReports" ng-class="[{\'answer-highlight\': technical_report_countHighlight}]"> <dt>Technical Reports</dt> <dd>{{technicalReports}}</dd> </div> <div ng-show="otherDocuments" ng-class="[{\'answer-highlight\': other_document_countHighlight}]"> <dt>Other Documents</dt> <dd>{{otherDocuments}}</dd> </div> </dl> </div> <!-- Pie Chart --> <div class="small-pie" id="pie-chart"></div> </div> </div> <!-- Author list --> <div ng-show="listName === listTypes[1]"> <div class="col-md-3"> <top-header></top-header> <ul class="results-list clear"> <li ng-repeat="item in list | orderBy : \'name\' | orderBy : \'-value\' | limitTo : listLength"> <a ng-href="{{listName | limitTo : listName.length - 1}}/{{item.id}}" class="list-name">{{item.name}}</a> <!-- <small class="highlight" uib-tooltip="ITA Publication count">({{item.value}})</small> --> </li> </ul> </div> <div class="col-md-9"> <input id="acInput" class="scatterInput" type="checkbox" checked> <input id="indInput" class="scatterInput" type="checkbox" checked> <input id="govInput" class="scatterInput" type="checkbox" checked> <!-- <input id="unInput" class="scatterInput" type="checkbox" checked> --> <div id="chart"></div> <div class="chart-btns"> <button ng-show="scatterYAxis === scatterYAxisOpts[1]" class="btn" id="h-index">H-Index</button> <button ng-show="scatterYAxis === scatterYAxisOpts[0]" class="btn" id="citation-count">Citation Count</button> </div> </div> </div> <!-- Venue list --> <div ng-show="listName === listTypes[2]"> <div class="col-md-12"> <top-header></top-header> <ul class="results-list clear"> <li ng-repeat="item in list | orderBy : \'name\' | orderBy : \'-value\' | limitTo : listLength"> <a ng-href="{{listName | limitTo : listName.length - 1}}/{{item.id}}/" class="list-name">{{item.name}}</a> <!-- <small ng-if="item.value" class="highlight">({{item.value}})</small> --> </li> </ul> </div> </div> <!-- Projects list --> <!-- <div ng-show="listName === listTypes[3]">\n        <div class="col-md-12">\n          <top-header></top-header>\n\n          <ul class="results-list clear">\n            <div ng-repeat="area in areaNames | orderBy">\n              <h6>{{area}}</h6>\n\n              <li class="indented-list-item" ng-repeat="item in projects[area] | orderBy : \'name\' | orderBy : \'-value\' | limitTo : listLength">\n                <a class="list-name" ng-href="{{listName | limitTo : listName.length - 1}}/{{item.id}}">{{item.name}}</a>\n                <small ng-if="item.value" class="highlight">({{item.value}} papers)</small>\n              </li>\n            </div>\n          </ul>\n        </div>\n      </div> --> <!-- Organisation list --> <div ng-show="listName === listTypes[4]"> <div class="col-md-12"> <top-header></top-header> <h3 class="floating-header header-extension"> sorted by <span uib-dropdown on-toggle="toggled(open)"> <a href id="simple-dropdown" uib-dropdown-toggle> <span class="highlight bold list-name">{{sortName}}<span class="caret"></span></span> </a> <ul class="uib-dropdown-menu" aria-labelledby="simple-dropdown"> <li role="menuitem" ng-repeat="type in sortNames"> <a href="#" ng-click="sort($index)">{{type | capitalise}}</a> </li> </ul> </span> </h3> <div class="authorFilters filters-right"> <label class="ac"></label> <input id="acInput" type="checkbox" ng-model="acInput"> <label class="ind"></label> <input id="indInput" type="checkbox" ng-model="indInput"> <label class="gov"></label> <input id="govInput" type="checkbox" ng-model="govInput"> </div> <div class="col-md-6 clear"> <ul class="results-list no-bullets"> <li ng-repeat="item in list | orderBy : \'name\' | orderBy : sortValue | filter : filterOrganisations | limitTo : listLength"> <!-- Organisation list --> <span ng-class="item.class"></span> <a ng-href="{{listName | limitTo : listName.length - 1}}/{{item.id}}" class="list-name">{{item.name}}</a> <!-- <small ng-if="sortName === sortNames[0] && item.value" class="highlight" uib-tooltip="Number of authors">({{item.value}})</small><small ng-if="sortName === sortNames[1] && item.papers" class="highlight" uib-tooltip="ITA Publication count">({{item.papers}})</small> --> </li> </ul> </div> <div class="col-md-6"> <p class="helper-text center">Hover over a section of the sunburst to view details.</p> <div class="sunburst"></div> </div> </div> </div> <!-- Co-authors list --> <div ng-if="listName === listTypes[5]"> <div> <top-header></top-header> <div class="authorFilters filters-right"> <label class="ac"></label> <input id="acInput" type="checkbox" ng-model="acInput"> <label class="ind"></label> <input id="indInput" type="checkbox" ng-model="indInput"> <label class="gov"></label> <input id="govInput" type="checkbox" ng-model="govInput"> </div> </div> <div class="clear" edge-bundle-chart num-authors="listLength" ac="acInput" gov="govInput" ind="indInput"></div> </div> </div> </div> </div>'),
a.put("views/organisation.html",'<div class="col-md-12 footer-padding"> <div class="row"> <!-- Description --> <p class="center"> <span ng-class="[{\'answer-highlight\': nameHighlight}]">{{name}}</span> <span class="highlight"> (<span ng-class="[{\'answer-highlight\': is_located_atHighlight}]">{{country}}</span>, <span ng-class="[{\'answer-highlight\': typeHighlight}]">{{industry}}</span>) </span> </p> </div> <div class="row"> <div class="col-md-9"> <div class="list-view"> <div ng-show="currentView === views[0]" id="org-papers-chart"> <h3>Papers</h3> <div id="bar-chart"></div> </div> <div ng-show="currentView === views[1]" id="org-papers-list"> <h3 class="floating-header">Papers</h3> <div class="authorFilters"> <label ng-show="journalPapers" class="journal"></label> <input ng-show="journalPapers" id="journalInput" type="checkbox" ng-model="journalInput"> <label ng-show="externalPapers" class="external-conference"></label> <input ng-show="externalPapers" id="externalInput" type="checkbox" ng-model="externalInput"> <label ng-show="patents" class="patent"></label> <input ng-show="patents" id="patentInput" type="checkbox" ng-model="patentInput"> <label ng-show="internalPapers" class="internal-conference"></label> <input ng-show="internalPapers" id="internalInput" type="checkbox" ng-model="internalInput"> <label ng-show="technicalReports" class="technical-report"></label> <input ng-show="technicalReports" id="technicalInput" type="checkbox" ng-model="technicalInput"> <label ng-show="otherDocuments" class="other-document"></label> <input ng-show="otherDocuments" id="otherInput" type="checkbox" ng-model="otherInput"> </div> <ul class="results-list clear"> <li class="no-bullets" ng-repeat="item in papers | limitTo : listLength | orderObjectBy : \'weight\' : \'-name\' | filter : filterPapers"> <span ng-class="[className, (\'document-\' + $index)]" ng-repeat="className in item.class track by $index"></span> <a ng-href="paper/{{item.id}}" class="list-name">{{item.name}}</a> <small ng-if="item.noteworthy"><span class="glyphicon glyphicon-star-empty highlight" aria-hidden="true"></span> ({{item.noteworthy}})</small> <!-- <small ng-if="item.value" class="highlight" uib-tooltip="Citation count">({{item.value}})</small> --> </li> </ul> </div> <div ng-show="currentView === views[2]" id="org-authors-list"> <h3>Authors</h3> <!-- Results list --> <ul class="results-list" ng-class="[{\'answer-highlight\': employsHighlight}]"> <li ng-repeat="item in employees | limitTo : listLength | orderObjectBy : \'value\' : \'-name\'"> <a ng-href="author/{{item.id}}" class="list-name">{{item.name}}</a> <!-- <small ng-show="item.value" class="highlight" uib-tooltip="Total ITA Publications">({{item.value}})</small> --> </li> </ul> </div> <div ng-show="currentView === views[0]" class="float-right"> <span class="helper-text">Click a bar on the graph to show papers.</span> </div> <div class="center"> <button ng-show="currentView !== views[0]" class="btn view-btn" ng-click="showView(views[0])">Show Papers Chart</button> <button ng-show="currentView !== views[1]" class="btn view-btn" ng-click="showView(views[1])">List Papers</button> <button ng-show="currentView !== views[2]" class="btn view-btn" ng-click="showView(views[2])">List Authors</button> </div> </div> </div> <div class="col-md-3 side-list-view"> <div> <h3>Statistics</h3> <div class="total-publication-count"> <dl class="dl-horizontal dl-publications" ng-class="[{\'answer-highlight\': publicationsHighlight}]"> <div ng-show="totalPublications" ng-class="[{\'answer-highlight\': total_publication_countHighlight}]"> <dt>Total ITA Publications</dt> <dd>{{totalPublications}}</dd> </div> </dl> <dl class="dl-horizontal dl-publications" ng-class="[{\'answer-highlight\': publicationsHighlight}]"> <div ng-show="journalPapers" ng-class="[{\'answer-highlight\': journal_paper_countHighlight}]"> <dt>Journals</dt> <dd>{{journalPapers}}</dd> </div> <div ng-show="externalPapers" ng-class="[{\'answer-highlight\': external_paper_countHighlight}]"> <dt>External Conferences</dt> <dd>{{externalPapers}}</dd> </div> <div ng-show="patents" ng-class="[{\'answer-highlight\': patent_countHighlight}]"> <dt>Patents</dt> <dd>{{patents}}</dd> </div> <div ng-show="internalPapers" ng-class="[{\'answer-highlight\': internal_paper_countHighlight}]"> <dt>Internal Conferences</dt> <dd>{{internalPapers}}</dd> </div> <div ng-show="technicalReports" ng-class="[{\'answer-highlight\': technical_report_countHighlight}]"> <dt>Technical Reports</dt> <dd>{{technicalReports}}</dd> </div> <div ng-show="otherDocuments" ng-class="[{\'answer-highlight\': other_document_countHighlight}]"> <dt>Other Documents</dt> <dd>{{otherDocuments}}</dd> </div> </dl> </div> </div> <!-- <h3>Publications</h3> --> <!-- Pie Chart --> <div class="col-md-3"> <div class="small-pie" id="pie-chart"></div> </div> </div> </div> </div>'),a.put("views/paper.html",'<div class="col-md-12 footer-padding"> <div class="row"> <!-- Title --> <p class="center"> <span class="highlight" ng-class="[{\'answer-highlight\': titleHighlight}]">{{title}}</span> was published <span class="highlight" ng-class="[{\'answer-highlight\': publish_dateHighlight}]">{{published}}</span> <span ng-if="noteworthy" class="glyphicon glyphicon-star-empty" aria-hidden="true"></span> </p> </div> <div class="row"> <!-- Paper --> <div class="col-md-6"> <img class="paper-img" id="paper-img" ng-src="{{source}}" ng-class="[{\'answer-highlight\': paper_thumbnailHighlight}]"> <div class="paper-buttons"> <button ng-if="paperSource && source !== paperSource" ng-click="show(\'paper\')" class="btn">Show Paper</button> <button ng-if="posterSource && source !== posterSource" ng-click="show(\'poster\')" class="btn">Show Poster</button> <button ng-if="presentationSource && source !== presentationSource" ng-click="show(\'presentation\')" class="btn">Show Presentation</button> </div> </div> <!-- Details --> <div class="col-md-6"> <div class="row"> <div class="col-md-12"> <!-- Authors --> <dl class="dl-horizontal" ng-class="[{\'answer-highlight\': authorHighlight}]"> <dt>Authors</dt> <dd> <span ng-repeat="author in orderedAuthors"> <a ng-href="author/{{author.id}}">{{author.name}}</a><span ng-if="$index !== orderedAuthors.length - 1">, </span> </span> <small>({{orderedAuthors.length}})</small> </dd> </dl> <dl class="dl-horizontal" ng-class="[{\'answer-highlight\': projectHighlight}]"> <dt>Project</dt> <!-- <dd ng-if="project"><a ng-href="project/{{project.id}}">{{project.name}}</a></dd> --> <dd ng-if="project">{{project.name}}</dd> <dd ng-if="!project">Unknown</dd> </dl> <!-- Abstract --> <dl class="dl-horizontal" ng-class="[{\'answer-highlight\': abstractHighlight}]"> <dt>Abstract</dt> <dd class="paper-abstract" id="paper-abstract"> {{abstract}} <button ng-if="!abstract" class="btn" ng-click="addAbstract()"> Add Abstract </button> </dd> </dl> <!-- Citations --> <dl class="dl-horizontal" ng-class="[{\'answer-highlight\': citation_countHighlight}]"> <dt>Citations</dt> <dd> <a ng-if="citationCount" ng-href="{{citationCount.url}}">{{citationCount.count}}</a> <span ng-if="!citationCount"> <a ng-href="{{scholarLink}}">Unknown</a> <button class="btn" ng-click="addCitationCount()">Add Citation Count</button> </span> </dd> </dl> <!-- Paper Type --> <dl class="dl-horizontal" ng-class="[{\'answer-highlight\': paper_typeHighlight}]"> <dt>Paper Type</dt> <dd>{{paperType}} <span class="paper-type-left-margin" ng-class="paperClass"></span></dd> </dl> <!-- Noteworthy reason --> <dl class="dl-horizontal" ng-if="noteworthy"> <dt>Noteworthy</dt> <dd>{{noteworthy}}</dd> </dl> <div ng-if="!showVenue"> <!-- Variants --> <dl class="dl-horizontal" class="paper-variants" ng-class="[{\'answer-highlight\': variantHighlight}]"> <dt>Variants</dt> <dd> <ul ng-if="variants.length > 0" class="results-list no-bullets no-min-list"> <li ng-repeat="variant in variants"> <span ng-class="variant.className"></span> <a ng-href="paper/{{variant.id}}">{{variant.name}}</a> </li> </ul> <span ng-if="variants.length === 0" class="details">None</span> </dd> </dl> <!-- Old Venue --> <dl class="dl-horizontal"> <dt>Venue</dt> <dd>{{oldVenue}}</dd> </dl> <!-- Download Link --> <div class="paper-download-buttons"> <a class="btn" ng-if="paperDownloadUrl" ng-href="{{paperDownloadUrl}}" ng-class="[{\'answer-highlight\': paper_fileHighlight}]" download> Download Paper </a> <a class="btn" ng-if="posterDownloadUrl" ng-href="{{posterDownloadUrl}}" ng-class="[{\'answer-highlight\': poster_fileHighlight}]" download>Download Poster</a> <a class="btn" ng-if="presentationDownloadUrl" ng-href="{{presentationDownloadUrl}}" ng-class="[{\'answer-highlight\': presentation_fileHighlight}]" download>Download Presentation</a> </div> </div> </div> </div> <div ng-if="showVenue" class="row"> <!-- Venue --> <div class="col-md-6"> <div ng-class="[{\'answer-highlight\': venueHighlight}]"> <h5>Venue</h5> <ui-gmap-google-map center="map.center" zoom="map.zoom"> <ui-gmap-marker idkey="marker.id" coords="marker.coords"></ui-gmap-marker> </ui-gmap-google-map> <a ng-href="venue/{{venue.id}}/{{venue.year}}">{{venue.name}}</a> </div> </div> <div class="col-md-6"> <!-- Similar Papers --> <div class="paper-variants" ng-class="[{\'answer-highlight\': variantHighlight}]"> <h5>Variants</h5> <ul ng-if="variants.length > 0" class="results-list no-bullets no-min-list"> <li ng-repeat="variant in variants"> <span ng-class="variant.className"></span> <a ng-href="paper/{{variant.id}}">{{variant.name}}</a> </li> </ul> <span ng-if="variants.length === 0" class="details">None</span> </div> <div ng-if="oldVenue"> <h5>Venue</h5> <span class="details">{{oldVenue}}</span> </div> <!-- Download Link --> <div class="paper-download-buttons"> <a class="btn" ng-if="paperDownloadUrl" ng-href="{{paperDownloadUrl}}" ng-class="[{\'answer-highlight\': paper_fileHighlight}]" download> Download Paper </a> <a class="btn" ng-if="posterDownloadUrl" ng-href="{{posterDownloadUrl}}" ng-class="[{\'answer-highlight\': poster_fileHighlight}]" download>Download Poster</a> <a class="btn" ng-if="presentationDownloadUrl" ng-href="{{presentationDownloadUrl}}" ng-class="[{\'answer-highlight\': presentation_fileHighlight}]" download>Download Presentation</a> </div> </div> </div> </div> </div> </div>'),a.put("views/project.html",'<div class="col-md-12 footer-padding"> <div class="row"> <!-- Description --> <p class="center"> <span ng-class="[{\'answer-highlight\': nameHighlight}]">{{name}}</span> <span class="highlight" ng-class="[{\'answer-highlight\': technical_areaHighlight}]">({{technicalArea}})</span> </p> </div> <div class="row"> <div class="list-view"> <h3 class="floating-header">Publications</h3> <div class="authorFilters"> <label class="journal"></label> <input id="journalInput" type="checkbox" ng-model="journalInput"> <label class="external-conference"></label> <input id="externalInput" type="checkbox" ng-model="externalInput"> <label class="internal-conference"></label> <input id="internalInput" type="checkbox" ng-model="internalInput"> <label class="technical-report"></label> <input id="technicalInput" type="checkbox" ng-model="technicalInput"> <label class="other-document"></label> <input id="otherInput" type="checkbox" ng-model="otherInput"> </div> <div class="col-md-12 clear" ng-class="[{\'answer-highlight\': publicationsHighlight}]"> <!-- Results list --> <ul class="results-list" id="publications-results-list"> <li class="no-bullets" ng-repeat="item in publications | orderBy : \'name\' | orderBy : \'-citations\' | filter : filterPapers"> <span ng-class="[className, (\'document-\' + $index)]" ng-repeat="className in item.class track by $index"></span> <a ng-href="paper/{{item.id}}" class="list-name">{{item.name}}</a> <!-- <small class="highlight">({{item.citations}})</small> --> </li> <p ng-if="publications.length === 0">No publications found.</p> </ul> </div> </div> </div> </div>'),a.put("views/results.html",'<div class="col-md-12 footer-padding"> <div class="row"> <!-- Question --> <p class="description">{{qa.question}}</p> </div> <div class="row"> <div class="list-view"> <h3> View top <input class="highlight bold list-num" ng-model="listLength"> results </h3> <div ng-if="qa.type === \'list\'"> <!-- Results list --> <ul class="results-list"> <li ng-repeat="item in qa.answer | limitTo : listLength"> <a ng-href="{{item.url}}" class="list-name">{{item.name}} <small ng-if="item.value" class="highlight">({{item.value}})</small></a> </li> </ul> </div> </div> </div> </div>'),a.put("views/statistics.html",'<div class="col-md-12 footer-padding"> <div class="row"> <!-- Description --> <p class="center details">A statistical summary of publications by year.</p> </div> <div class="row"> <div class="list-view"> <table class="clear"> <tr> <th>Publication Year</th> <th>Total Publications</th> <th colspan="2">Single Institute Paper Count</th> <th colspan="2">Collaborative Paper Count</th> <th colspan="2">International Paper Count</th> <th colspan="2">Government Paper Count</th> <th colspan="2">Journal Paper Count</th> <th colspan="2">External Conference Paper Count</th> <th colspan="1">Patent Count</th> <!-- <th>Total Authors</th> --> <th colspan="1">Active ITA Authors</th> <!-- <th colspan="2">Active Non-ITA Authors</th> --> <th class="no-border">Total Citations</th> </tr> <tr ng-repeat="row in statistics | orderBy : \'scope\'"> <td>{{row.scope}}</td> <td>{{row.totalPubs}}</td> <td class="no-border">{{row.singleInstCount}}</td> <td class="percentage">{{row.singleInstCountPercent}} &#37;</td> <td class="no-border">{{row.collabCount}}</td> <td class="percentage">{{row.collabCountPercent}} &#37;</td> <td class="no-border">{{row.internationalCount}}</td> <td class="percentage">{{row.internationalCountPercent}} &#37;</td> <td class="no-border">{{row.govCount}}</td> <td class="percentage">{{row.govCountPercent}} &#37;</td> <td class="no-border">{{row.journalCount}}</td> <td class="percentage">{{row.journalCountPercent}} &#37;</td> <td class="no-border">{{row.extCount}}</td> <td class="percentage">{{row.extCountPercent}} &#37;</td> <td>{{row.patentCount}}</td> <!-- <td>{{row.totalAuthors}}</td> --> <td>{{row.activeITA}}</td> <!-- <td class="percentage">{{row.activeITAPercent}} &#37;</td> --> <!-- <td class="no-border">{{row.activeNonITA}}</td> --> <!-- <td class="percentage">{{row.activeNonITAPercent}} &#37;</td> --> <td class="no-border">{{row.citations}}</td> </tr> </table> </div> </div> </div>'),a.put("views/top-header.html",'<!-- Top 50 --> <h3 class="floating-header"> View top <input class="highlight bold list-num" ng-model="listLength"> <span uib-dropdown on-toggle="toggled(open)"> <a href id="simple-dropdown" uib-dropdown-toggle> <span class="highlight bold list-name">{{listName}}<span class="caret"></span></span> </a> <ul class="uib-dropdown-menu" aria-labelledby="simple-dropdown"> <li role="menuitem" ng-repeat="type in listTypes"> <a ng-show="type !== listTypes[3]" href="#" ng-click="select(type)">{{type | capitalise}}</a> </li> </ul> </span> </h3>'),a.put("views/venue.html",'<div class="col-md-12 footer-padding"> <div class="row"> <!-- Title --> <p class="center"> <span class="highlight" ng-class="[{\'answer-highlight\': full_nameHighlight}]">{{venueName}}</span> ran for <span class="highlight" ng-class="[{\'answer-highlight\': years_ranHighlight}]">{{yearsRan}} years</span> </p> </div> <!-- Venue map --> <div class="row"> <div class="col-md-8"> <h3 class="indent"> Details for <span uib-dropdown on-toggle="toggled(open)"> <a href id="simple-dropdown" uib-dropdown-toggle> <span class="highlight bold list-name">{{selectedYear}}<span class="caret"></span></span> </a> <ul class="uib-dropdown-menu" aria-labelledby="simple-dropdown"> <li role="menuitem" ng-repeat="year in years | orderBy : \'+\'"> <a href="#" ng-click="select(year)">{{year | capitalise}}</a> </li> </ul> </span> </h3> <datamap map="map.world" plugins="map.plugins" plugin-data="map.pluginData" class="venue-map" id="venue-map" ng-class="[{\'answer-highlight\': occurs_atHighlight}]"> </datamap> </div> <!-- Papers --> <div class="col-md-4 venue-details"> <h3>Papers</h3> <ul class="mini results-list"> <li class="no-bullets" ng-repeat="paper in papers | orderBy : \'name\' | orderBy : \'-citations\'"> <span ng-class="paper.class"></span><a ng-href="paper/{{paper.id}}" class="list-name">{{paper.name}}</a> <!-- <small class="highlight">({{paper.citations}})</small> --> </li> </ul> <h3>Organisations</h3> <ul class="mini results-list"> <li ng-if="org.fillKey !== \'EVENT\'" ng-repeat="org in bubbles | orderBy : \'name\' | orderBy : \'-radius\'"> <a ng-href="organisation/{{org.id}}" class="list-name">{{org.name}}</a> <!-- <small class="highlight">({{org.radius / multiplier}})</small> --> </li> </ul> <h3>Authors</h3> <ul class="mini results-list"> <li ng-repeat="(id, author) in authors | orderObjectBy : \'count\' : \'-name\'"> <a ng-href="author/{{author.id}}" class="list-name">{{author.name}}</a> <!-- <small class="highlight">({{author.count}})</small> --> </li> </ul> <h3>Details</h3> <div class="venue-dates"> <span>Date: </span><span ng-class="[{\'answer-highlight\': start_dateHighlight}]">{{startDate}}</span> - <span ng-class="[{\'answer-highlight\': end_dateHighlight}]">{{endDate}}</span> </div> <a ng-href="{{url}}"><button class="btn view-btn" ng-class="[{\'answer-highlight\': urlHighlight}]">Website</button></a> </div> </div> <!-- <div class="row">\n  Topics\n  <div class="col-md-10">\n    <div class="panel">\n      <span id="topics-chart"></span>\n    </div>\n  </div>\n\n  Posters\n  <div class="col-md-2">\n    <div class="panel">\n      <h5>Posters</h5>\n    </div>\n  </div>\n</div> --></div>'),a.put("views/voice-warning.html",'<div class="modal-header"> <h3 class="modal-title">Warning</h3> </div> <div class="modal-body"> <p>Any spoken data will be sent to Google\'s servers for processing. Your data <strong>will</strong> leave the security of this network.</p> </div> <div class="modal-footer"> <button class="btn" type="button" ng-click="ok()">OK</button> <button class="btn right-btn" type="button" ng-click="cancel()">Cancel</button> </div>')}]);